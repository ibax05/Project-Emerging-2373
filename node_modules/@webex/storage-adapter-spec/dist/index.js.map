{"version":3,"names":["_testHelperChai","require","noop","runAbstractStorageAdapterSpec","adapter","key","namespace","obj","a","primitive","options","logger","error","warning","log","info","debug","trace","describe","it","assert","isRejected","bind","bound","beforeAll","then","b","put","get","result","deepEqual","forEach","falsey","concat","_promise","default","all","primitive2","del","undefined","clear"],"sources":["index.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {assert} from '@webex/test-helper-chai';\n\nfunction noop() {\n  // intentionally empty\n}\n\nexport default function runAbstractStorageAdapterSpec(adapter) {\n  const key = 'key';\n  const namespace = 'namespace';\n  const obj = {a: 1};\n  const primitive = 1;\n  const options = {\n    logger: {\n      error: noop,\n      warning: noop,\n      log: noop,\n      info: noop,\n      debug: noop,\n      trace: noop,\n    },\n  };\n\n  describe('#bind()', () => {\n    // namespace and options.logger are required more to make sure we always\n    // call bind correctly rather than to make sure the adapter uses them.\n    it('requires a namespace', () => assert.isRejected(adapter.bind(), /`namespace` is required/));\n\n    it('requires a logger option', () =>\n      assert.isRejected(adapter.bind(namespace), /`options.logger` is required/));\n\n    it('returns a db interface', () => adapter.bind(namespace, options));\n\n    describe('bound', () => {\n      let bound;\n\n      beforeAll(() =>\n        adapter.bind(namespace, options).then((b) => {\n          bound = b;\n        })\n      );\n\n      describe('#put()', () => {\n        it('puts a primitive into the store', () =>\n          bound\n            .put(key, primitive)\n            .then(() => bound.get(key).then((result) => assert.deepEqual(result, primitive))));\n\n        [0, false, null].forEach((falsey) => {\n          it(`puts falsey primitive \\`${falsey}\\` into the store`, () =>\n            bound\n              .put(key, falsey)\n              .then(() => bound.get(key).then((result) => assert.deepEqual(result, falsey))));\n        });\n\n        it('puts an object into the store', () =>\n          bound\n            .put(key, obj)\n            .then(() => bound.get(key).then((result) => assert.deepEqual(result, obj))));\n\n        it('puts an array into the store', () =>\n          bound\n            .put(key, [1, 2])\n            .then(() => bound.get(key).then((result) => assert.deepEqual(result, [1, 2]))));\n\n        it('puts an array back into the store', () =>\n          bound\n            .put(key, [1, 2])\n            .then(() => bound.get(key).then((result) => assert.deepEqual(result, [1, 2])))\n            .then(() => bound.put(key, [1, 2, 3]))\n            .then(() => bound.get(key).then((result) => assert.deepEqual(result, [1, 2, 3]))));\n\n        it('handles concurrency', () =>\n          Promise.all([bound.put(key, 1), bound.put(key, 2), bound.put(key, 3)]).then(() =>\n            bound.get(key).then((result) => assert.deepEqual(result, 3))\n          ));\n\n        it('puts same key in different namespaces', () =>\n          bound.put(key, primitive).then(() =>\n            adapter.bind('namespace2', options).then((b) => {\n              const primitive2 = 2;\n\n              b.put(key, primitive2).then(() =>\n                Promise.all([\n                  bound.get(key).then((result) => assert.deepEqual(result, primitive)),\n                  b.get(key).then((result) => assert.deepEqual(result, primitive2)),\n                ])\n              );\n            })\n          ));\n      });\n\n      describe('#get()', () => {\n        it('gets a primitive from the store', () =>\n          bound\n            .put(key, primitive)\n            .then(() => bound.get(key).then((result) => assert.deepEqual(result, primitive))));\n\n        it('gets an object from the store', () =>\n          bound\n            .put(key, obj)\n            .then(() => bound.get(key).then((result) => assert.deepEqual(result, obj))));\n\n        it('rejects if the key cannot be found', () => assert.isRejected(bound.get('notakey')));\n      });\n\n      describe('#del()', () => {\n        it('removes a primitive from the store', () =>\n          bound\n            .put(key, primitive)\n            .then(() => bound.get(key).then((result) => assert.deepEqual(result, primitive)))\n            .then(() => bound.del(key))\n            .then(() => assert.isRejected(bound.get(key))));\n\n        it('removes an object from the store', () =>\n          bound\n            .put(key, obj)\n            .then(() => bound.get(key).then((result) => assert.deepEqual(result, obj)))\n            .then(() => bound.del(key))\n            .then(() => assert.isRejected(bound.get(key))));\n\n        it('removes an item from the store when putting `undefined`', () =>\n          bound\n            .put(key, undefined)\n            .then(() => bound.del(key))\n            .then(() => assert.isRejected(bound.get(key))));\n      });\n\n      describe('#clear()', () => {\n        it('clears a primitive from the store', () =>\n          bound\n            .put(key, primitive)\n            .then(() => bound.get(key).then((result) => assert.deepEqual(result, primitive)))\n            .then(() => bound.clear())\n            .then(() => assert.isRejected(bound.get(key))));\n\n        it('clears an object from the store', () =>\n          bound\n            .put(key, obj)\n            .then(() => bound.get(key).then((result) => assert.deepEqual(result, obj)))\n            .then(() => bound.clear(key))\n            .then(() => assert.isRejected(bound.get(key))));\n\n        it('clears an item from the store when putting `undefined`', () =>\n          bound\n            .put(key, undefined)\n            .then(() => bound.clear(key))\n            .then(() => assert.isRejected(bound.get(key))));\n      });\n    });\n  });\n}\n"],"mappings":"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"}