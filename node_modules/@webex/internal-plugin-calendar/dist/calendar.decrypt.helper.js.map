{"version":3,"names":["_decryptTextProp","ctx","name","key","object","_promise","default","resolve","webex","internal","encryption","decryptText","uri","then","plaintext","DecryptHelper","decryptSchedulerDataResponse","data","encryptionKeyUrl","decryptedParticipants","encryptedParticipants","map","participant","all","decryptedScheduleFor","_values","encryptedScheduleFor","flatMap","item","decryptedMeetingJoinInfo","meetingJoinInfo","decryptedOrganizer","encryptedOrganizer","concat","decryptFreeBusyResponse","calendarFreeBusyScheduleResponse","calendarFreeBusyItems","calendarFreeBusyItem","_default","exports"],"sources":["calendar.decrypt.helper.js"],"sourcesContent":["const _decryptTextProp = (ctx, name, key, object) => {\n  if (!object[name]) {\n    return Promise.resolve();\n  }\n\n  return ctx.webex.internal.encryption\n    .decryptText(key.uri || key, object[name])\n    .then((plaintext) => {\n      object[name] = plaintext;\n    });\n};\n\nconst DecryptHelper = {\n  /**\n   * Decrypt scheduler data response\n   * @param {object} [ctx] context\n   * @param {object} [data] scheduler data response\n   * @returns {Promise} Resolves with decrypted response\n   * */\n  decryptSchedulerDataResponse: (ctx, data) => {\n    if (!data) {\n      return Promise.resolve();\n    }\n\n    if (!data.encryptionKeyUrl) {\n      return Promise.resolve();\n    }\n\n    // Decrypt participant properties if meeting object contains participants\n    const decryptedParticipants = data.encryptedParticipants\n      ? data.encryptedParticipants.map((participant) =>\n          Promise.all([\n            _decryptTextProp(ctx, 'encryptedEmailAddress', data.encryptionKeyUrl, participant),\n            _decryptTextProp(ctx, 'encryptedName', data.encryptionKeyUrl, participant),\n          ])\n        )\n      : [];\n\n    // Decrypt encryptedScheduleFor properties if meeting object contains SOB\n    const decryptedScheduleFor = Promise.all(\n      Object.values(data.encryptedScheduleFor || {}).flatMap((item) => [\n        _decryptTextProp(ctx, 'encryptedEmail', data.encryptionKeyUrl, item),\n        _decryptTextProp(ctx, 'encryptedDisplayName', data.encryptionKeyUrl, item),\n      ])\n    );\n\n    // Decrypt meetingJoinInfo properties if meeting object contains meetingJoinInfo\n    const decryptedMeetingJoinInfo = data.meetingJoinInfo\n      ? Promise.all([\n          _decryptTextProp(ctx, 'meetingJoinURI', data.encryptionKeyUrl, data.meetingJoinInfo),\n          _decryptTextProp(ctx, 'meetingJoinURL', data.encryptionKeyUrl, data.meetingJoinInfo),\n        ])\n      : [];\n\n    const decryptedOrganizer = data.encryptedOrganizer\n      ? Promise.all([\n          _decryptTextProp(\n            ctx,\n            'encryptedEmailAddress',\n            data.encryptionKeyUrl,\n            data.encryptedOrganizer\n          ),\n          _decryptTextProp(ctx, 'encryptedName', data.encryptionKeyUrl, data.encryptedOrganizer),\n        ])\n      : [];\n\n    return Promise.all(\n      [\n        _decryptTextProp(ctx, 'encryptedSubject', data.encryptionKeyUrl, data),\n        _decryptTextProp(ctx, 'encryptedLocation', data.encryptionKeyUrl, data),\n        _decryptTextProp(ctx, 'encryptedNotes', data.encryptionKeyUrl, data),\n        _decryptTextProp(ctx, 'webexURI', data.encryptionKeyUrl, data),\n        _decryptTextProp(ctx, 'webexURL', data.encryptionKeyUrl, data),\n        _decryptTextProp(ctx, 'spaceMeetURL', data.encryptionKeyUrl, data),\n        _decryptTextProp(ctx, 'spaceURI', data.encryptionKeyUrl, data),\n        _decryptTextProp(ctx, 'spaceURL', data.encryptionKeyUrl, data),\n      ].concat(\n        decryptedOrganizer,\n        decryptedParticipants,\n        decryptedScheduleFor,\n        decryptedMeetingJoinInfo\n      )\n    );\n  },\n  /**\n   * Decrypt free-busy response\n   * @param {object} [ctx] context\n   * @param {object} [data] free-busy response\n   * @returns {Promise} Resolves with decrypted response\n   * */\n  decryptFreeBusyResponse: (ctx, data) => {\n    if (!data) {\n      return Promise.resolve();\n    }\n\n    if (!data.calendarFreeBusyScheduleResponse) {\n      return Promise.resolve();\n    }\n\n    if (!data.calendarFreeBusyScheduleResponse.encryptionKeyUrl) {\n      return Promise.resolve();\n    }\n\n    const calendarFreeBusyItems = data.calendarFreeBusyScheduleResponse.calendarFreeBusyItems\n      ? data.calendarFreeBusyScheduleResponse.calendarFreeBusyItems.map((calendarFreeBusyItem) =>\n          Promise.all([\n            _decryptTextProp(\n              ctx,\n              'email',\n              data.calendarFreeBusyScheduleResponse.encryptionKeyUrl,\n              calendarFreeBusyItem\n            ),\n          ])\n        )\n      : [];\n\n    return Promise.all([].concat(calendarFreeBusyItems));\n  },\n};\n\nexport default DecryptHelper;\n"],"mappings":"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"}