{"version":3,"names":["_util","_interopRequireDefault","require","_ampersandState","_storage","WebexPlugin","AmpState","extend","derived","boundedStorage","deps","fn","makeWebexPluginStore","unboundedStorage","config","cache","webex","namespace","getNamespace","toLowerCase","logger","console","parent","collection","Error","session","type","ready","default","clear","options","_this","_keys","attributes","forEach","key","unset","_children","_collections","reset","initialize","_this2","_len","arguments","length","args","Array","_key","_apply","prototype","_dataTypes","_cloneDeep2","set","bind","on","model","trigger","concat","inspect","depth","util","_omit2","serialize","props","request","_this$webex","apply","upload","_this$webex2","when","eventName","_this3","_len2","rest","_key2","_promise","resolve","once","_len3","_key3","_filterSetParameters","value","attrs","_isObject2","_default","exports"],"sources":["webex-plugin.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport util from 'util';\n\nimport AmpState from 'ampersand-state';\nimport {cloneDeep, isObject, omit} from 'lodash';\n\nimport {makeWebexPluginStore} from './storage';\n\n/**\n * @class\n */\nconst WebexPlugin = AmpState.extend({\n  derived: {\n    boundedStorage: {\n      deps: [],\n      fn() {\n        return makeWebexPluginStore('bounded', this);\n      },\n    },\n    unboundedStorage: {\n      deps: [],\n      fn() {\n        return makeWebexPluginStore('unbounded', this);\n      },\n    },\n    config: {\n      // figure out why caching config breaks the refresh integration test\n      // but not the refresh automation test.\n      cache: false,\n      deps: ['webex', 'webex.config'],\n      fn() {\n        if (this.webex && this.webex.config) {\n          const namespace = this.getNamespace();\n\n          if (namespace) {\n            return this.webex.config[namespace.toLowerCase()];\n          }\n\n          return this.webex.config;\n        }\n\n        return {};\n      },\n    },\n\n    logger: {\n      deps: ['webex', 'webex.logger'],\n      fn() {\n        return this.webex.logger || console;\n      },\n    },\n\n    webex: {\n      deps: ['parent'],\n      fn() {\n        if (!this.parent && !this.collection) {\n          throw new Error(\n            'Cannot determine `this.webex` without `this.parent` or `this.collection`. Please initialize `this` via `children` or `collection` or set `this.parent` manually'\n          );\n        }\n\n        /* eslint consistent-this: [0] */\n        let parent = this;\n\n        while (parent.parent || parent.collection) {\n          parent = parent.parent || parent.collection;\n        }\n\n        return parent;\n      },\n    },\n  },\n\n  session: {\n    parent: {\n      type: 'any',\n    },\n    /**\n     * Indicates this plugin is ready to be used. Defaults to true but can be\n     * overridden by plugins as appropriate. Used by {@link WebexCore#read}\n     * @instance\n     * @memberof WebexPlugin\n     * @type {boolean}\n     */\n    ready: {\n      default: true,\n      type: 'boolean',\n    },\n  },\n\n  /**\n   * Overrides AmpersandState#clear to make sure we never unset `parent` and\n   * recursively visits children/collections.\n   * @instance\n   * @memberof WebexPlugin\n   * @param {Object} options\n   * @returns {WebexPlugin}\n   */\n  clear(options) {\n    Object.keys(this.attributes).forEach((key) => {\n      if (key !== 'parent') {\n        this.unset(key, options);\n      }\n    });\n\n    Object.keys(this._children).forEach((key) => {\n      this[key].clear();\n    });\n\n    Object.keys(this._collections).forEach((key) => {\n      this[key].reset();\n    });\n\n    return this;\n  },\n\n  /**\n   * Initializer\n   * @private\n   * @param {Object} attrs\n   * @param {Object} options\n   * @returns {undefined}\n   */\n  initialize(...args) {\n    Reflect.apply(AmpState.prototype.initialize, this, args);\n\n    // HACK to deal with the fact that AmpersandState#dataTypes#set is a pure\n    // function.\n    this._dataTypes = cloneDeep(this._dataTypes);\n    Object.keys(this._dataTypes).forEach((key) => {\n      if (this._dataTypes[key].set) {\n        this._dataTypes[key].set = this._dataTypes[key].set.bind(this);\n      }\n    });\n    // END HACK\n\n    // Propagate change:[attribute] events from children\n    this.on('change', (model, options) => {\n      if (this.parent) {\n        this.parent.trigger(\n          `change:${this.getNamespace().toLowerCase()}`,\n          this.parent,\n          this,\n          options\n        );\n      }\n    });\n  },\n\n  /**\n   * @instance\n   * @memberof WebexPlugin\n   * @param {number} depth\n   * @private\n   * @returns {Object}\n   */\n  inspect(depth) {\n    return util.inspect(\n      omit(\n        this.serialize({\n          props: true,\n          session: true,\n          derived: true,\n        }),\n        'boundedStorage',\n        'unboundedStorage',\n        'config',\n        'logger',\n        'webex',\n        'parent'\n      ),\n      {depth}\n    );\n  },\n\n  request(...args) {\n    return this.webex.request(...args);\n  },\n\n  upload(...args) {\n    return this.webex.upload(...args);\n  },\n\n  when(eventName, ...rest) {\n    if (rest && rest.length > 0) {\n      throw new Error('#when() does not accept a callback, you must attach to its promise');\n    }\n\n    return new Promise((resolve) => {\n      this.once(eventName, (...args) => resolve(args));\n    });\n  },\n\n  /**\n   * Helper function for dealing with both forms of {@link AmpersandState#set()}\n   * @param {string} key\n   * @param {mixed} value\n   * @param {Object} options\n   * @private\n   * @returns {Array<Object, Object>}\n   */\n  _filterSetParameters(key, value, options) {\n    let attrs;\n\n    if (isObject(key) || key === null) {\n      attrs = key;\n      options = value;\n    } else {\n      attrs = {};\n      attrs[key] = value;\n    }\n\n    options = options || {};\n\n    return [attrs, options];\n  },\n});\n\nexport default WebexPlugin;\n"],"mappings":"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"}