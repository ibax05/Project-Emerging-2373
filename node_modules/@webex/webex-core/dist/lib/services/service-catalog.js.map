{"version":3,"names":["_url","_interopRequireDefault","require","_ampersandState","_serviceUrl","ownKeys","object","enumerableOnly","keys","_Object$keys3","_Object$getOwnPropertySymbols","symbols","filter","sym","_Object$getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","Object","forEach","key","_defineProperty2","default","_Object$getOwnPropertyDescriptors","_Object$defineProperties","_Object$defineProperty","_createForOfIteratorHelper","o","allowArrayLike","it","_Symbol","_Symbol$iterator","_Array$isArray","_unsupportedIterableToArray","F","s","n","done","value","e","_e","f","TypeError","normalCompletion","didErr","err","call","step","next","_e2","return","minLen","_arrayLikeToArray","prototype","toString","slice","constructor","name","_Array$from","test","arr","len","arr2","Array","ServiceCatalog","AmpState","extend","namespace","props","serviceGroups","discovery","override","preauth","postauth","signin","status","ready","collecting","isReady","allowedDomains","_getUrl","serviceGroup","serviceUrls","concat","_toConsumableArray2","find","serviceUrl","_listServiceUrls","_loadServiceUrls","services","_this","existingService","service","_unloadServiceUrls","_this2","splice","indexOf","clean","findClusterId","url","incomingUrlObj","Url","parse","serviceUrlObj","_i","_Object$keys","_keys","_iterator","_step","defaultUrl","_iterator2","hosts","_step2","host","hostname","id","_iterator3","_step3","homeCluster","undefined","findServiceFromClusterId","_ref","clusterId","_ref$priorityHost","priorityHost","identifiedServiceUrl","get","findServiceUrlFromUrl","findAllowedDomain","urlObj","allowedDomain","includes","getAllowedDomains","list","output","markFailedUrl","noPriorityHosts","_this3","failHost","setAllowedDomains","updateServiceUrls","serviceHostmap","_this4","currentServiceUrls","unusedUrls","every","item","serviceObj","ServiceUrl","trigger","waitForCatalog","timeout","_this5","_promise","resolve","reject","timeoutTimer","setTimeout","Error","once","clearTimeout","_default","exports"],"sources":["service-catalog.js"],"sourcesContent":["import Url from 'url';\n\nimport AmpState from 'ampersand-state';\n\nimport ServiceUrl from './service-url';\n\n/* eslint-disable no-underscore-dangle */\n/**\n * @class\n */\nconst ServiceCatalog = AmpState.extend({\n  namespace: 'ServiceCatalog',\n\n  props: {\n    serviceGroups: [\n      'object',\n      true,\n      () => ({\n        discovery: [],\n        override: [],\n        preauth: [],\n        postauth: [],\n        signin: [],\n      }),\n    ],\n    status: [\n      'object',\n      true,\n      () => ({\n        discovery: {\n          ready: false,\n          collecting: false,\n        },\n        override: {\n          ready: false,\n          collecting: false,\n        },\n        preauth: {\n          ready: false,\n          collecting: false,\n        },\n        postauth: {\n          ready: false,\n          collecting: false,\n        },\n        signin: {\n          ready: false,\n          collecting: false,\n        },\n      }),\n    ],\n    isReady: ['boolean', false, false],\n    allowedDomains: ['array', false, () => []],\n  },\n\n  /**\n   * @private\n   * Search the service url array to locate a `ServiceUrl`\n   * class object based on its name.\n   * @param {string} name\n   * @param {string} [serviceGroup]\n   * @returns {ServiceUrl}\n   */\n  _getUrl(name, serviceGroup) {\n    const serviceUrls =\n      typeof serviceGroup === 'string'\n        ? this.serviceGroups[serviceGroup] || []\n        : [\n            ...this.serviceGroups.override,\n            ...this.serviceGroups.postauth,\n            ...this.serviceGroups.signin,\n            ...this.serviceGroups.preauth,\n            ...this.serviceGroups.discovery,\n          ];\n\n    return serviceUrls.find((serviceUrl) => serviceUrl.name === name);\n  },\n\n  /**\n   * @private\n   * Generate an array of `ServiceUrl`s that is organized from highest auth\n   * level to lowest auth level.\n   * @returns {Array<ServiceUrl>} - array of `ServiceUrl`s\n   */\n  _listServiceUrls() {\n    return [\n      ...this.serviceGroups.override,\n      ...this.serviceGroups.postauth,\n      ...this.serviceGroups.signin,\n      ...this.serviceGroups.preauth,\n      ...this.serviceGroups.discovery,\n    ];\n  },\n\n  /**\n   * @private\n   * Safely load one or more `ServiceUrl`s into this `Services` instance.\n   * @param {string} serviceGroup\n   * @param  {Array<ServiceUrl>} services\n   * @returns {Services}\n   */\n  _loadServiceUrls(serviceGroup, services) {\n    // declare namespaces outside of loop\n    let existingService;\n\n    services.forEach((service) => {\n      existingService = this._getUrl(service.name, serviceGroup);\n\n      if (!existingService) {\n        this.serviceGroups[serviceGroup].push(service);\n      }\n    });\n\n    return this;\n  },\n\n  /**\n   * @private\n   * Safely unload one or more `ServiceUrl`s into this `Services` instance\n   * @param {string} serviceGroup\n   * @param  {Array<ServiceUrl>} services\n   * @returns {Services}\n   */\n  _unloadServiceUrls(serviceGroup, services) {\n    // declare namespaces outside of loop\n    let existingService;\n\n    services.forEach((service) => {\n      existingService = this._getUrl(service.name, serviceGroup);\n\n      if (existingService) {\n        this.serviceGroups[serviceGroup].splice(\n          this.serviceGroups[serviceGroup].indexOf(existingService),\n          1\n        );\n      }\n    });\n\n    return this;\n  },\n\n  /**\n   * Clear all collected catalog data and reset catalog status.\n   *\n   * @returns {void}\n   */\n  clean() {\n    this.serviceGroups.preauth.length = 0;\n    this.serviceGroups.signin.length = 0;\n    this.serviceGroups.postauth.length = 0;\n    this.status.preauth = {ready: false};\n    this.status.signin = {ready: false};\n    this.status.postauth = {ready: false};\n  },\n\n  /**\n   * Search over all service groups to find a cluster id based\n   * on a given url.\n   * @param {string} url - Must be parsable by `Url`\n   * @returns {string} - ClusterId of a given url\n   */\n  findClusterId(url) {\n    const incomingUrlObj = Url.parse(url);\n    let serviceUrlObj;\n\n    for (const key of Object.keys(this.serviceGroups)) {\n      for (const service of this.serviceGroups[key]) {\n        serviceUrlObj = Url.parse(service.defaultUrl);\n\n        for (const host of service.hosts) {\n          if (incomingUrlObj.hostname === host.host && host.id) {\n            return host.id;\n          }\n        }\n\n        if (serviceUrlObj.hostname === incomingUrlObj.hostname && service.hosts.length > 0) {\n          // no exact match, so try to grab the first home cluster\n          for (const host of service.hosts) {\n            if (host.homeCluster) {\n              return host.id;\n            }\n          }\n\n          // no match found still, so return the first entry\n          return service.hosts[0].id;\n        }\n      }\n    }\n\n    return undefined;\n  },\n\n  /**\n   * Search over all service groups and return a service value from a provided\n   * clusterId. Currently, this method will return either a service name, or a\n   * service url depending on the `value` parameter. If the `value` parameter\n   * is set to `name`, it will return a service name to be utilized within the\n   * Services plugin methods.\n   * @param {object} params\n   * @param {string} params.clusterId - clusterId of found service\n   * @param {boolean} [params.priorityHost = true] - returns priority host url if true\n   * @param {string} [params.serviceGroup] - specify service group\n   * @returns {object} service\n   * @returns {string} service.name\n   * @returns {string} service.url\n   */\n  findServiceFromClusterId({clusterId, priorityHost = true, serviceGroup} = {}) {\n    const serviceUrls =\n      typeof serviceGroup === 'string'\n        ? this.serviceGroups[serviceGroup] || []\n        : [\n            ...this.serviceGroups.override,\n            ...this.serviceGroups.postauth,\n            ...this.serviceGroups.signin,\n            ...this.serviceGroups.preauth,\n            ...this.serviceGroups.discovery,\n          ];\n\n    const identifiedServiceUrl = serviceUrls.find((serviceUrl) =>\n      serviceUrl.hosts.find((host) => host.id === clusterId)\n    );\n\n    if (identifiedServiceUrl) {\n      return {\n        name: identifiedServiceUrl.name,\n        url: identifiedServiceUrl.get(priorityHost, clusterId),\n      };\n    }\n\n    return undefined;\n  },\n\n  /**\n   * Find a service based on the provided url.\n   * @param {string} url - Must be parsable by `Url`\n   * @returns {serviceUrl} - ServiceUrl assocated with provided url\n   */\n  findServiceUrlFromUrl(url) {\n    const incomingUrlObj = Url.parse(url);\n    const serviceUrls = [\n      ...this.serviceGroups.discovery,\n      ...this.serviceGroups.preauth,\n      ...this.serviceGroups.signin,\n      ...this.serviceGroups.postauth,\n      ...this.serviceGroups.override,\n    ];\n\n    return serviceUrls.find((serviceUrl) => {\n      if (incomingUrlObj.hostname === Url.parse(serviceUrl.defaultUrl).hostname) {\n        return true;\n      }\n\n      if (serviceUrl.hosts.find((host) => host.host === incomingUrlObj.hostname)) {\n        return true;\n      }\n\n      return false;\n    });\n  },\n\n  /**\n   * Finds an allowed domain that matches a specific url.\n   *\n   * @param {string} url - The url to match the allowed domains against.\n   * @returns {string} - The matching allowed domain.\n   */\n  findAllowedDomain(url) {\n    const urlObj = Url.parse(url);\n\n    if (!urlObj.host) {\n      return undefined;\n    }\n\n    return this.allowedDomains.find((allowedDomain) => urlObj.host.includes(allowedDomain));\n  },\n\n  /**\n   * Get a service url from the current services list by name.\n   * @param {string} name\n   * @param {boolean} priorityHost\n   * @param {string} serviceGroup\n   * @returns {string}\n   */\n  get(name, priorityHost, serviceGroup) {\n    const serviceUrl = this._getUrl(name, serviceGroup);\n\n    return serviceUrl ? serviceUrl.get(priorityHost) : undefined;\n  },\n\n  /**\n   * Get the current allowed domains list.\n   *\n   * @returns {Array<string>} - the current allowed domains list.\n   */\n  getAllowedDomains() {\n    return [...this.allowedDomains];\n  },\n\n  /**\n   * Creates an object where the keys are the service names\n   * and the values are the service urls.\n   * @param {boolean} priorityHost - use the highest priority if set to `true`\n   * @param {string} [serviceGroup]\n   * @returns {Record<string, string>}\n   */\n  list(priorityHost, serviceGroup) {\n    const output = {};\n\n    const serviceUrls =\n      typeof serviceGroup === 'string'\n        ? this.serviceGroups[serviceGroup] || []\n        : [\n            ...this.serviceGroups.discovery,\n            ...this.serviceGroups.preauth,\n            ...this.serviceGroups.signin,\n            ...this.serviceGroups.postauth,\n            ...this.serviceGroups.override,\n          ];\n\n    if (serviceUrls) {\n      serviceUrls.forEach((serviceUrl) => {\n        output[serviceUrl.name] = serviceUrl.get(priorityHost);\n      });\n    }\n\n    return output;\n  },\n\n  /**\n   * Mark a priority host service url as failed.\n   * This will mark the host associated with the\n   * `ServiceUrl` to be removed from the its\n   * respective host array, and then return the next\n   * viable host from the `ServiceUrls` host array,\n   * or the `ServiceUrls` default url if no other priority\n   * hosts are available, or if `noPriorityHosts` is set to\n   * `true`.\n   * @param {string} url\n   * @param {boolean} noPriorityHosts\n   * @returns {string}\n   */\n  markFailedUrl(url, noPriorityHosts) {\n    const serviceUrl = this._getUrl(\n      Object.keys(this.list()).find((key) => this._getUrl(key).failHost(url))\n    );\n\n    if (!serviceUrl) {\n      return undefined;\n    }\n\n    return noPriorityHosts ? serviceUrl.get(false) : serviceUrl.get(true);\n  },\n\n  /**\n   * Set the allowed domains for the catalog.\n   *\n   * @param {Array<string>} allowedDomains - allowed domains to be assigned.\n   * @returns {void}\n   */\n  setAllowedDomains(allowedDomains) {\n    this.allowedDomains = [...allowedDomains];\n  },\n\n  /**\n   * Update the current list of `ServiceUrl`s against a provided\n   * service hostmap.\n   * @emits ServiceCatalog#preauthorized\n   * @emits ServiceCatalog#postauthorized\n   * @param {string} serviceGroup\n   * @param {object} serviceHostmap\n   * @returns {Services}\n   */\n  updateServiceUrls(serviceGroup, serviceHostmap) {\n    const currentServiceUrls = this.serviceGroups[serviceGroup];\n\n    const unusedUrls = currentServiceUrls.filter((serviceUrl) =>\n      serviceHostmap.every((item) => item.name !== serviceUrl.name)\n    );\n\n    this._unloadServiceUrls(serviceGroup, unusedUrls);\n\n    serviceHostmap.forEach((serviceObj) => {\n      const service = this._getUrl(serviceObj.name, serviceGroup);\n\n      if (service) {\n        service.defaultUrl = serviceObj.defaultUrl;\n        service.hosts = serviceObj.hosts || [];\n      } else {\n        this._loadServiceUrls(serviceGroup, [\n          new ServiceUrl({\n            ...serviceObj,\n          }),\n        ]);\n      }\n    });\n\n    this.status[serviceGroup].ready = true;\n    this.trigger(serviceGroup);\n\n    return this;\n  },\n\n  /**\n   * Wait until the service catalog is available,\n   * or reject after a timeout of 60 seconds.\n   * @param {string} serviceGroup\n   * @param {number} [timeout] - in seconds\n   * @returns {Promise<void>}\n   */\n  waitForCatalog(serviceGroup, timeout) {\n    return new Promise((resolve, reject) => {\n      if (this.status[serviceGroup].ready) {\n        resolve();\n      }\n\n      const timeoutTimer = setTimeout(\n        () =>\n          reject(\n            new Error(\n              `services: timeout occured while waiting for '${serviceGroup}' catalog to populate`\n            )\n          ),\n        timeout ? timeout * 1000 : 60000\n      );\n\n      this.once(serviceGroup, () => {\n        clearTimeout(timeoutTimer);\n        resolve();\n      });\n    });\n  },\n});\n/* eslint-enable no-underscore-dangle */\n\nexport default ServiceCatalog;\n"],"mappings":"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"}