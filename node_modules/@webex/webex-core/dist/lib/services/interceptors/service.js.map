{"version":3,"names":["_httpCore","require","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf2","default","result","NewTarget","constructor","_Reflect$construct","arguments","apply","_possibleConstructorReturn2","Reflect","sham","Proxy","Boolean","prototype","valueOf","call","e","trailingSlashes","ServiceInterceptor","_Interceptor","_inherits2","_super","_classCallCheck2","_createClass2","key","value","onRequest","options","_this","uri","normalizeOptions","validateOptions","services","webex","internal","service","resource","waitForService","name","then","serviceUrl","generateUri","catch","_promise","reject","Error","concat","length","undefined","formattedService","replace","formattedResource","api","create","Interceptor","exports"],"sources":["service.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {Interceptor} from '@webex/http-core';\n\nconst trailingSlashes = /(?:^\\/)|(?:\\/$)/;\n\n/**\n * @class\n */\nexport default class ServiceInterceptor extends Interceptor {\n  /**\n   * @returns {ServiceInterceptor}\n   */\n  static create() {\n    /* eslint no-invalid-this: [0] */\n    return new ServiceInterceptor({webex: this});\n  }\n\n  /* eslint-disable no-param-reassign */\n  /**\n   * @see Interceptor#onRequest\n   * @param {Object} options - The request PTO.\n   * @returns {Object} - The mutated request PTO.\n   */\n  onRequest(options) {\n    // Validate that the PTO includes a uri property.\n    if (options.uri) {\n      return options;\n    }\n\n    // Normalize and validate the PTO.\n    this.normalizeOptions(options);\n    this.validateOptions(options);\n\n    // Destructure commonly referenced namespaces.\n    const {services} = this.webex.internal;\n    const {service, resource} = options;\n\n    // Attempt to collect the service url.\n    return services\n      .waitForService({name: service})\n      .then((serviceUrl) => {\n        // Generate the combined service url and resource.\n        options.uri = this.generateUri(serviceUrl, resource);\n\n        return options;\n      })\n      .catch(() =>\n        Promise.reject(new Error(`service-interceptor: '${service}' is not a known service`))\n      );\n  }\n\n  /* eslint-disable class-methods-use-this */\n  /**\n   * Generate a usable request uri string from a service url and a resouce.\n   *\n   * @param {string} serviceUrl - The service url.\n   * @param {string} [resource] - The resouce to be appended to the service url.\n   * @returns {string} - The combined service url and resource.\n   */\n  generateUri(serviceUrl, resource = '') {\n    const formattedService = serviceUrl.replace(trailingSlashes, '');\n    const formattedResource = resource.replace(trailingSlashes, '');\n\n    return `${formattedService}/${formattedResource}`;\n  }\n\n  /**\n   * Normalizes request options relative to service identification.\n   *\n   * @param {Object} options - The request PTO.\n   * @returns {Object} - The mutated request PTO.\n   */\n  normalizeOptions(options) {\n    // Validate if the api property is used.\n    if (options.api) {\n      // Assign the service property the value of the api property if necessary.\n      options.service = options.service || options.api;\n      delete options.api;\n    }\n  }\n\n  /**\n   * Validates that the appropriate options for this interceptor are present.\n   *\n   * @param {Object} options - The request PTO.\n   * @returns {Object} - The mutated request PTO.\n   */\n  validateOptions(options) {\n    if (!options.resource) {\n      throw new Error('a `resource` parameter is required');\n    }\n\n    if (!options.service) {\n      throw new Error(\"a valid 'service' parameter is required\");\n    }\n  }\n  /* eslint-enable class-methods-use-this, no-param-reassign */\n}\n"],"mappings":"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"}