{"version":3,"names":["mixinWebexInternalCorePlugins","State","config","interceptors","registerPlugin","name","constructor","options","arguments","length","undefined","prototype","_children","replace","proxies","Error","_keys","default","forEach","key","_merge2","_has2","payloadTransformer","predicates","concat","_get2","transforms","onBeforeLogout","_isArray2","fn","push","plugin","_definition","ready","_State$prototype$_der","_derived","depList","def","deps","createDerivedProperty","modelProto","definition","_isFunction2","cache","dep","_deps","_union2","_defineProperty","get","_getDerivedProperty","set","TypeError"],"sources":["webex-internal-core-plugin-mixin.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {get, has, isArray, isFunction, merge, union} from 'lodash';\n\n/**\n * Mixes a plugin system into an AmpState object (specifically, into WebexCore)\n * @param {AmpState} State\n * @param {Object} config\n * @param {Object} interceptors\n * @returns {AmpState}\n */\nexport default function mixinWebexInternalCorePlugins(State, config, interceptors) {\n  // eslint-disable-next-line complexity\n  State.registerPlugin = function registerPlugin(name, constructor, options = {}) {\n    if (State.prototype._children[name] && !options.replace) {\n      return;\n    }\n\n    State.prototype._children[name] = constructor;\n\n    if (options.proxies) {\n      throw new Error('Proxies are not currently supported for private plugins');\n    }\n\n    if (options.interceptors) {\n      Object.keys(options.interceptors).forEach((key) => {\n        interceptors[key] = options.interceptors[key];\n      });\n    }\n\n    if (options.config) {\n      merge(config, options.config);\n    }\n\n    if (has(options, 'payloadTransformer.predicates')) {\n      config.payloadTransformer.predicates = config.payloadTransformer.predicates.concat(\n        get(options, 'payloadTransformer.predicates')\n      );\n    }\n\n    if (has(options, 'payloadTransformer.transforms')) {\n      config.payloadTransformer.transforms = config.payloadTransformer.transforms.concat(\n        get(options, 'payloadTransformer.transforms')\n      );\n    }\n\n    if (options.onBeforeLogout) {\n      config.onBeforeLogout = config.onBeforeLogout || [];\n      const onBeforeLogout = isArray(options.onBeforeLogout)\n        ? options.onBeforeLogout\n        : [options.onBeforeLogout];\n\n      onBeforeLogout.forEach((fn) =>\n        config.onBeforeLogout.push({\n          plugin: name,\n          fn,\n        })\n      );\n    }\n\n    // Only mess with the plugin's derived properties if it's an amp-state plugin\n    if (constructor.prototype._definition && constructor.prototype._definition.ready) {\n      const {fn, depList} = State.prototype._derived.ready;\n      const def = {\n        deps: depList.concat(`${name}.ready`),\n        fn,\n      };\n\n      createDerivedProperty(State.prototype, 'ready', def);\n    }\n  };\n\n  return State;\n}\n\n/**\n * Extracted from ampersand-state\n * @param {Object} modelProto\n * @param {string} name\n * @param {Object} definition\n * @private\n * @returns {undefined}\n */\nfunction createDerivedProperty(modelProto, name, definition) {\n  const def = (modelProto._derived[name] = {\n    fn: isFunction(definition) ? definition : definition.fn,\n    cache: definition.cache !== false,\n    depList: definition.deps || [],\n  });\n\n  // add to our shared dependency list\n  def.depList.forEach((dep) => {\n    modelProto._deps[dep] = union(modelProto._deps[dep] || [], [name]);\n  });\n\n  // defined a top-level getter for derived names\n  Reflect.defineProperty(modelProto, name, {\n    get() {\n      return this._getDerivedProperty(name);\n    },\n    set() {\n      throw new TypeError(`\\`${name}\\` is a derived property, it can't be set directly.`);\n    },\n  });\n}\n"],"mappings":"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"}