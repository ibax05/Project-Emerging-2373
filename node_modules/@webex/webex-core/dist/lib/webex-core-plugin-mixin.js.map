{"version":3,"names":["mixinWebexCorePlugins","State","config","interceptors","registerPlugin","name","constructor","options","arguments","length","undefined","prototype","_children","replace","proxies","forEach","key","createDerivedProperty","deps","concat","fn","_keys","default","_merge2","_has2","payloadTransformer","predicates","_get2","transforms","onBeforeLogout","_isArray2","push","plugin","_definition","ready","_State$prototype$_der","_derived","depList","def","modelProto","definition","_isFunction2","cache","dep","_deps","_union2","_defineProperty","get","_getDerivedProperty","set","TypeError"],"sources":["webex-core-plugin-mixin.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {get, has, isArray, isFunction, merge, union} from 'lodash';\n\n/**\n * Mixes a plugin system into an AmpState object (specifically, into WebexCore)\n * @param {AmpState} State\n * @param {Object} config\n * @param {Object} interceptors\n * @returns {AmpState}\n */\nexport default function mixinWebexCorePlugins(State, config, interceptors) {\n  // eslint-disable-next-line complexity\n  State.registerPlugin = function registerPlugin(name, constructor, options = {}) {\n    if (State.prototype._children[name] && !options.replace) {\n      return;\n    }\n\n    State.prototype._children[name] = constructor;\n\n    if (options.proxies) {\n      options.proxies.forEach((key) => {\n        createDerivedProperty(State.prototype, key, {\n          deps: [`${name}.${key}`],\n          fn() {\n            return this[name][key];\n          },\n        });\n      });\n    }\n\n    if (options.interceptors) {\n      Object.keys(options.interceptors).forEach((key) => {\n        interceptors[key] = options.interceptors[key];\n      });\n    }\n\n    if (options.config) {\n      merge(config, options.config);\n    }\n\n    if (has(options, 'payloadTransformer.predicates')) {\n      config.payloadTransformer.predicates = config.payloadTransformer.predicates.concat(\n        get(options, 'payloadTransformer.predicates')\n      );\n    }\n\n    if (has(options, 'payloadTransformer.transforms')) {\n      config.payloadTransformer.transforms = config.payloadTransformer.transforms.concat(\n        get(options, 'payloadTransformer.transforms')\n      );\n    }\n\n    if (options.onBeforeLogout) {\n      config.onBeforeLogout = config.onBeforeLogout || [];\n      const onBeforeLogout = isArray(options.onBeforeLogout)\n        ? options.onBeforeLogout\n        : [options.onBeforeLogout];\n\n      onBeforeLogout.forEach((fn) =>\n        config.onBeforeLogout.push({\n          plugin: name,\n          fn,\n        })\n      );\n    }\n\n    // Only mess with the plugin's derived properties if it's an amp-state plugin\n    if (constructor.prototype._definition && constructor.prototype._definition.ready) {\n      const {fn, depList} = State.prototype._derived.ready;\n      const def = {\n        deps: depList.concat(`${name}.ready`),\n        fn,\n      };\n\n      createDerivedProperty(State.prototype, 'ready', def);\n    }\n  };\n\n  return State;\n}\n\n/**\n * Extracted from ampersand-state\n * @param {Object} modelProto\n * @param {string} name\n * @param {Object} definition\n * @private\n * @returns {undefined}\n */\nfunction createDerivedProperty(modelProto, name, definition) {\n  const def = (modelProto._derived[name] = {\n    fn: isFunction(definition) ? definition : definition.fn,\n    cache: definition.cache !== false,\n    depList: definition.deps || [],\n  });\n\n  // add to our shared dependency list\n  def.depList.forEach((dep) => {\n    modelProto._deps[dep] = union(modelProto._deps[dep] || [], [name]);\n  });\n\n  // defined a top-level getter for derived names\n  Reflect.defineProperty(modelProto, name, {\n    get() {\n      return this._getDerivedProperty(name);\n    },\n    set() {\n      throw new TypeError(`\\`${name}\\` is a derived property, it can't be set directly.`);\n    },\n  });\n}\n"],"mappings":"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"}