{"version":3,"names":["_events","require","_sinon","_interopRequireDefault","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf2","default","result","NewTarget","constructor","_Reflect$construct","arguments","apply","_possibleConstructorReturn2","Reflect","sham","Proxy","Boolean","prototype","valueOf","call","e","closeHandlers","_weakMap","errorHandlers","messageHandlers","openHandlers","setHandler","scope","map","type","fn","handler","get","removeListener","set","on","noop","MockWebSocket","_EventEmitter","_inherits2","_super","url","_this","protocol","length","undefined","options","_classCallCheck2","sinon","spy","_assertThisInitialized2","sequenceNumber","_createClass2","key","value","close","code","reason","readyState","onclose","open","_this2","emit","process","nextTick","data","_stringify","id","eventType","send","obj","_this3","JSON","parse","addEventListener","removeEventListener","EventEmitter","exports"],"sources":["index.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {EventEmitter} from 'events';\n\nimport sinon from 'sinon';\n\n/* eslint require-jsdoc: [0] */\n\nconst closeHandlers = new WeakMap();\nconst errorHandlers = new WeakMap();\nconst messageHandlers = new WeakMap();\nconst openHandlers = new WeakMap();\n\nfunction setHandler(scope, map, type, fn) {\n  const handler = map.get(scope);\n\n  if (handler) {\n    scope.removeListener(type, handler);\n  }\n  map.set(scope, fn);\n  if (fn) {\n    scope.on(type, fn);\n  }\n}\n\n// eslint-disable-next-line\nfunction noop() {}\n\n/**\n * Mock of WebSocket Class\n * @returns {MockWebSocket}\n */\nexport default class MockWebSocket extends EventEmitter {\n  constructor(url, protocol = [], options = {}) {\n    super();\n    this.url = url;\n    this.protocol = protocol;\n    this.options = options;\n\n    sinon.spy(this, 'send');\n    sinon.spy(this, 'close');\n\n    this.sequenceNumber = 0;\n\n    this.on('message', () => {\n      this.sequenceNumber += 1;\n    });\n  }\n\n  get onclose() {\n    return closeHandlers.get(this) || noop;\n  }\n\n  set onclose(fn) {\n    setHandler(this, closeHandlers, 'close', fn);\n  }\n\n  get onerror() {\n    return errorHandlers.get(this) || noop;\n  }\n\n  set onerror(fn) {\n    setHandler(this, errorHandlers, 'error', fn);\n  }\n\n  get onmessage() {\n    return messageHandlers.get(this) || noop;\n  }\n\n  set onmessage(fn) {\n    setHandler(this, messageHandlers, 'message', fn);\n  }\n\n  get onopen() {\n    return openHandlers.get(this) || noop;\n  }\n\n  set onopen(fn) {\n    setHandler(this, openHandlers, 'open', fn);\n  }\n\n  close(code, reason) {\n    this.readyState = 3;\n    this.readyState = 4;\n    this.onclose({\n      code,\n      reason,\n    });\n  }\n\n  open() {\n    this.readyState = 1;\n    this.emit('open');\n    process.nextTick(() => {\n      this.emit('message', {\n        data: JSON.stringify({\n          id: 'mockid',\n          data: {\n            eventType: 'mercury.buffer_state',\n          },\n        }),\n      });\n    });\n  }\n\n  send(obj) {\n    try {\n      obj = JSON.parse(obj);\n    } catch (e) {\n      // ignore\n    }\n    if (obj.type === 'ping') {\n      process.nextTick(() => {\n        this.emit('message', {\n          data: JSON.stringify({\n            id: obj.id,\n            type: 'pong',\n            sequenceNumber: this.sequenceNumber,\n          }),\n        });\n      });\n    }\n  }\n\n  addEventListener(...args) {\n    return this.on(...args);\n  }\n\n  removeEventListener(...args) {\n    return this.removeListener(...args);\n  }\n}\n"],"mappings":"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"}