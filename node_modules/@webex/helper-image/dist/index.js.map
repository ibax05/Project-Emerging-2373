{"version":3,"names":["_processImage","_interopRequireDefault","require","_detectFiletype","_require","Buffer","_require2","parse","updateImageOrientation","file","options","arguments","length","undefined","_promise","default","resolve","reader","FileReader","readAsArrayBuffer","onload","arrayBuffer","result","buf","from","then","shouldNotAddExifData","readExifData","_x","_x2","_readExifData","apply","_asyncToGenerator2","_regenerator","mark","_callee","exifData","Orientation","ExifImageHeight","ExifImageWidth","wrap","_callee$","_context","prev","next","type","mimeType","translateValues","sent","orientation","exifHeight","exifWidth","image","abrupt","stop"],"sources":["index.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\n/* eslint no-unused-vars: [\"error\", { \"vars\": \"local\" }] */\n// eslint-disable-next-line no-redeclare\n\nconst {Buffer} = require('safe-buffer');\nconst {parse} = require('exifr/dist/lite.umd');\n\n/**\n * Updates the image file with exif information, required to correctly rotate the image activity\n * @param {Object} file\n * @param {Object} options\n * @param {boolean} options.shouldNotAddExifData\n * @returns {Promise<Object>}\n */\nexport function updateImageOrientation(file, options = {}) {\n  return new Promise((resolve) => {\n    const reader = new FileReader();\n\n    reader.readAsArrayBuffer(file);\n    reader.onload = function onload() {\n      const arrayBuffer = reader.result;\n      const buf = Buffer.from(arrayBuffer);\n\n      resolve(buf);\n    };\n  }).then((buf) => {\n    if (options.shouldNotAddExifData) {\n      return buf;\n    }\n\n    return readExifData(file, buf);\n  });\n}\n\n/**\n * Adds exif orientation information on the image file\n * @param {Object} file\n * @param {Object} buf\n * @returns {Promise<ExifImage>}\n */\nexport async function readExifData(file, buf) {\n  // For avatar images the file.type is set as image/jpeg, however for images shared in an activity file.mimeType is set as image/jpeg. Handling both conditions.\n  if (file && (file.type === 'image/jpeg' || file.mimeType === 'image/jpeg')) {\n    const exifData = await parse(buf, {translateValues: false});\n\n    if (exifData) {\n      const {Orientation, ExifImageHeight, ExifImageWidth} = exifData;\n\n      file.orientation = Orientation;\n      file.exifHeight = ExifImageHeight;\n      file.exifWidth = ExifImageWidth;\n\n      if (file.image) {\n        file.image.orientation = Orientation;\n      }\n    }\n  }\n\n  return buf;\n}\n\n/* eslint-enable complexity */\n\nexport {default as processImage} from './process-image';\nexport {default as detectFileType} from './detect-filetype';\n"],"mappings":"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"}