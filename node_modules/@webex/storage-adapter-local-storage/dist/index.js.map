{"version":3,"names":["_webexCore","require","namespaces","_weakMap","default","loggers","StorageAdapterLocalStorage","basekey","_classCallCheck2","Bound","_class","namespace","options","set","logger","_createClass2","key","value","_getRawData","rawData","localStorage","getItem","JSON","parse","_load","allData","get","_save","data","setItem","_stringify","clear","info","_promise","resolve","removeItem","del","_this","concat","_deleteProperty","_this2","reject","debug","NotFoundError","put","_this3","bind","Error","exports"],"sources":["index.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\n/* eslint-env browser */\n\nimport {NotFoundError} from '@webex/webex-core';\n\nconst namespaces = new WeakMap();\nconst loggers = new WeakMap();\n\n/**\n * localStorage adapter for webex-core storage layer\n */\nexport default class StorageAdapterLocalStorage {\n  /**\n   * @constructs {StorageAdapterLocalStorage}\n   * @param {string} basekey localStorage key underwhich all namespaces will be\n   * stored\n   */\n  constructor(basekey) {\n    /**\n     * localStorage binding\n     */\n    this.Bound = class {\n      /**\n       * @constructs {Bound}\n       * @param {string} namespace\n       * @param {Object} options\n       */\n      constructor(namespace, options) {\n        namespaces.set(this, namespace);\n        loggers.set(this, options.logger);\n      }\n\n      /**\n       * @private\n       * @returns {rawData}\n       */\n      _getRawData() {\n        const rawData = localStorage.getItem(basekey);\n\n        return rawData ? JSON.parse(rawData) : {};\n      }\n\n      /**\n       * @private\n       * @returns {mixed}\n       */\n      _load() {\n        const allData = this._getRawData();\n\n        return allData[namespaces.get(this)] || {};\n      }\n\n      /**\n       * @param {Object} data\n       * @private\n       * @returns {undefined}\n       */\n      _save(data) {\n        const allData = this._getRawData();\n\n        allData[namespaces.get(this)] = data;\n\n        localStorage.setItem(basekey, JSON.stringify(allData));\n      }\n\n      /**\n       * Clears the localStorage\n       * @param {string} key\n       * @returns {Promise}\n       */\n      clear() {\n        loggers.get(this).info('local-storage-store-adapter: clearing localStorage');\n\n        return Promise.resolve(localStorage.removeItem(basekey));\n      }\n\n      /**\n       * Removes the specified key\n       * @param {string} key\n       * @returns {Promise}\n       */\n      del(key) {\n        return new Promise((resolve) => {\n          loggers.get(this).info(`local-storage-store-adapter: deleting \\`${key}\\``);\n          const data = this._load();\n\n          Reflect.deleteProperty(data, key);\n          this._save(data);\n          resolve();\n        });\n      }\n\n      /**\n       * Retrieves the data at the specified key\n       * @param {string} key\n       * @returns {Promise<mixed>}\n       */\n      get(key) {\n        return new Promise((resolve, reject) => {\n          loggers.get(this).debug(`local-storage-store-adapter: reading \\`${key}\\``);\n          const data = this._load();\n          const value = data[key];\n\n          if (typeof value !== 'undefined') {\n            return resolve(value);\n          }\n\n          return reject(new NotFoundError(`No value found for ${key}`));\n        });\n      }\n\n      /**\n       * Stores the specified value at the specified key\n       * @param {string} key\n       * @param {mixed} value\n       * @returns {Promise}\n       */\n      put(key, value) {\n        return new Promise((resolve) => {\n          loggers.get(this).debug(`local-storage-store-adapter: writing \\`${key}\\``);\n          const data = this._load();\n\n          data[key] = value;\n          this._save(data);\n          resolve();\n        });\n      }\n    };\n  }\n\n  /**\n   * Returns an adapter bound to the specified namespace\n   * @param {string} namespace\n   * @param {Object} options\n   * @returns {Promise<Bound>}\n   */\n  bind(namespace, options) {\n    options = options || {};\n    if (!namespace) {\n      return Promise.reject(new Error('`namespace` is required'));\n    }\n\n    if (!options.logger) {\n      return Promise.reject(new Error('`options.logger` is required'));\n    }\n\n    options.logger.debug('local-storage-store-adapter: returning binding');\n\n    return Promise.resolve(new this.Bound(namespace, options));\n  }\n}\n"],"mappings":"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"}