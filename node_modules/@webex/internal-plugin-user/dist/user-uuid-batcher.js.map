{"version":3,"names":["_webexCore","require","AbstractUserUUIDRequestBatcher","Batcher","extend","namespace","prepareItem","item","_promise","default","resolve","email","handleHttpSuccess","res","_this","all","_keys","body","map","id","handleItemSuccess","handleItemFailure","response","getDeferredForResponse","then","defer","reject","fingerprintRequest","fingerprintResponse","FakeUserUUIDRequestBatcher","submitHttpRequest","payload","webex","request","method","service","resource","RealUserUUIDRequestBatcher","qs","shouldCreateUsers","UserUUIDBatcher","WebexPlugin","children","faker","creator","create","version","_default","exports"],"sources":["user-uuid-batcher.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {Batcher, WebexPlugin} from '@webex/webex-core';\n\n/**\n * @class\n */\nconst AbstractUserUUIDRequestBatcher = Batcher.extend({\n  namespace: 'User',\n\n  /**\n   * @param {string} item\n   * @returns {Promise<Object>}\n   */\n  prepareItem(item) {\n    return Promise.resolve({email: item});\n  },\n\n  /**\n   * @param {HttpResponseObject} res\n   * @returns {Promise}\n   */\n  handleHttpSuccess(res) {\n    return Promise.all(\n      Object.keys(res.body).map((email) => {\n        if (res.body[email] && res.body[email].id) {\n          return this.handleItemSuccess(email, res.body[email]);\n        }\n\n        return this.handleItemFailure(email, res.body[email]);\n      })\n    );\n  },\n\n  handleItemFailure(email, response) {\n    return this.getDeferredForResponse(email).then((defer) => {\n      defer.reject(response);\n    });\n  },\n\n  /**\n   * @param {string} email\n   * @param {Object} response\n   * @returns {Promise}\n   */\n  handleItemSuccess(email, response) {\n    return this.getDeferredForResponse(email).then((defer) => {\n      defer.resolve(response);\n    });\n  },\n\n  /**\n   * @param {string} email\n   * @returns {Promise<string>}\n   */\n  fingerprintRequest(email) {\n    return Promise.resolve(email.email || email);\n  },\n\n  /**\n   * @param {string} email\n   * @returns {Promise<string>}\n   */\n  fingerprintResponse(email) {\n    return Promise.resolve(email);\n  },\n});\n\n/**\n * @class\n */\nconst FakeUserUUIDRequestBatcher = AbstractUserUUIDRequestBatcher.extend({\n  /**\n   * @param {Object} payload\n   * @returns {Promise<HttpResponseObject>}\n   */\n  submitHttpRequest(payload) {\n    return this.webex.request({\n      method: 'POST',\n      service: 'conversation',\n      resource: '/users',\n      body: payload,\n    });\n  },\n});\n\n/**\n * @class\n */\nconst RealUserUUIDRequestBatcher = AbstractUserUUIDRequestBatcher.extend({\n  /**\n   * @param {Object} payload\n   * @returns {Promise<HttpResponseObject>}\n   */\n  submitHttpRequest(payload) {\n    return this.webex.request({\n      method: 'POST',\n      service: 'conversation',\n      resource: '/users',\n      body: payload,\n      qs: {\n        shouldCreateUsers: true,\n      },\n    });\n  },\n});\n\n/**\n * @class\n */\nconst UserUUIDBatcher = WebexPlugin.extend({\n  children: {\n    faker: FakeUserUUIDRequestBatcher,\n    creator: RealUserUUIDRequestBatcher,\n  },\n\n  /**\n   * @param {Object} payload\n   * @returns {Promise<Object>}\n   */\n  request(payload) {\n    return payload.create ? this.creator.request(payload.email) : this.faker.request(payload.email);\n  },\n});\n\nexport default UserUUIDBatcher;\n"],"mappings":"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"}