{"version":3,"names":["_common","require","ownKeys","object","enumerableOnly","keys","_Object$keys","_Object$getOwnPropertySymbols","symbols","filter","sym","_Object$getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","Object","forEach","key","_defineProperty2","default","_Object$getOwnPropertyDescriptors","_Object$defineProperties","_Object$defineProperty","usersByEmail","_weakMap","usersById","UserUUIDStore","_classCallCheck2","set","_map","_createClass2","value","add","user","_this","id","_promise","reject","Error","emailAddress","patterns","uuid","test","email","p1","getById","then","u","get","catch","p2","getByEmail","all","ret","resolve","exports"],"sources":["user-uuid-store.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {patterns} from '@webex/common';\n\nconst usersByEmail = new WeakMap();\nconst usersById = new WeakMap();\n\n/**\n * @class\n */\nexport default class UserUUIDStore {\n  /**\n   * @constructs {UserUUIDStore}\n   */\n  constructor() {\n    usersByEmail.set(this, new Map());\n    usersById.set(this, new Map());\n  }\n\n  /**\n   * Adds a user object to the store\n   * @param {Object} user\n   * @param {string} user.id\n   * @param {string} user.emailAddress\n   * @returns {Promise}\n   */\n  add(user) {\n    if (!user.id) {\n      return Promise.reject(new Error('`user.id` is required'));\n    }\n\n    if (!user.emailAddress) {\n      return Promise.reject(new Error('`user.emailAddress` is required'));\n    }\n\n    if (!patterns.uuid.test(user.id)) {\n      return Promise.reject(new Error('`user.id` does not appear to be a uuid'));\n    }\n\n    if (!patterns.email.test(user.emailAddress)) {\n      return Promise.reject(\n        new Error('`user.emailAddress` does not appear to be an email address')\n      );\n    }\n\n    const p1 = this.getById(user.id)\n      .then((u) => usersById.get(this).set(user.id, {...u, ...user}))\n      .catch(() => usersById.get(this).set(user.id, {...user}));\n\n    const p2 = this.getByEmail(user.emailAddress)\n      .then((u) => usersByEmail.get(this).set(user.emailAddress, {...u, ...user}))\n      .catch(() => usersByEmail.get(this).set(user.emailAddress, {...user}));\n\n    return Promise.all([p1, p2]);\n  }\n\n  /**\n   * Retrieves the specified user object from the store\n   * @param {string} id\n   * @returns {Promise<Object>}\n   */\n  get(id) {\n    if (patterns.uuid.test(id)) {\n      return this.getById(id);\n    }\n\n    if (patterns.email.test(id)) {\n      return this.getByEmail(id);\n    }\n\n    return Promise.reject(new Error('`id` does not appear to be a valid user identifier'));\n  }\n\n  /**\n   * Retrieves the specified user object by id from the store\n   * @param {Object} id\n   * @returns {Promise<Object>}\n   */\n  getById(id) {\n    const ret = usersById.get(this).get(id);\n\n    if (ret) {\n      return Promise.resolve(ret);\n    }\n\n    return Promise.reject(new Error('No user found by specified id'));\n  }\n\n  /**\n   * Retrieves the specified user object by id from the store\n   * @param {Object} email\n   * @returns {Promise<Object>}\n   */\n  getByEmail(email) {\n    const ret = usersByEmail.get(this).get(email);\n\n    if (ret) {\n      return Promise.resolve(ret);\n    }\n\n    return Promise.reject(new Error('No user found by specified email address'));\n  }\n}\n"],"mappings":"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"}