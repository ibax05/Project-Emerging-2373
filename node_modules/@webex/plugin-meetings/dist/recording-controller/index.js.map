{"version":3,"names":["_permission","_interopRequireDefault","require","_constants","_enums","_util","_loggerProxy","RecordingController","request","options","_classCallCheck2","default","_defineProperty2","initialize","set","_createClass2","key","value","extract","setLocusUrl","url","locusUrl","locusId","Util","extractLocusId","setDisplayHints","hints","displayHints","setSessionId","id","sessionId","setServiceUrl","serviceUrl","getLocusUrl","getLocusId","getSessionId","getServiceUrl","getDisplayHints","recordingService","action","body","meetingInfo","locusSessionId","recording","toLowerCase","uri","concat","method","HTTP_VERBS","PUT","recordingControls","record","deriveRecordingStates","LoggerProxy","logger","log","CONTROLS","PATCH","recordingFacade","_promise","reject","PermissionError","startRecording","RecordingAction","Start","stopRecording","Stop","pauseRecording","Pause","resumeRecording","Resume","exports"],"sources":["index.ts"],"sourcesContent":["import PermissionError from '../common/errors/permission';\nimport {CONTROLS, HTTP_VERBS} from '../constants';\nimport MeetingRequest from '../meeting/request';\nimport RecordingAction from './enums';\nimport Util from './util';\nimport LoggerProxy from '../common/logs/logger-proxy';\n\n/**\n * @description Recording manages the recording functionality of the meeting object, there should only be one instantation of recording per meeting\n * @export\n * @private\n * @class Recording\n */\nexport default class RecordingController {\n  /**\n   * @instance\n   * @type {MeetingRequest}\n   * @private\n   * @memberof RecordingController\n   */\n  private request: MeetingRequest;\n\n  /**\n   * @instance\n   * @type {Array}\n   * @private\n   * @memberof RecordingInfo\n   */\n  private displayHints: Array<string> = [];\n\n  /**\n   * @instance\n   * @type {string}\n   * @private\n   * @memberof RecordingInfo\n   */\n  private serviceUrl: string;\n\n  /**\n   * @instance\n   * @type {string}\n   * @private\n   * @memberof RecordingInfo\n   */\n  private sessionId: string;\n\n  /**\n   * @instance\n   * @type {string}\n   * @private\n   * @memberof RecordingInfo\n   */\n  private locusUrl: string;\n\n  /**\n   * @instance\n   * @type {string}\n   * @private\n   * @memberof RecordingInfo\n   */\n  private locusId: string;\n\n  /**\n   * @param {MeetingRequest} request\n   * @param {Object} options\n   * @constructor\n   * @memberof RecordingController\n   */\n  constructor(\n    request: MeetingRequest,\n    options?: {\n      serviceUrl?: string;\n      sessionId: string;\n      locusUrl: string;\n      displayHints?: Array<string>;\n    }\n  ) {\n    this.initialize(request);\n    this.set(options);\n  }\n\n  /**\n   * @param {MeetingRequest} request\n   * @param {LocusInfo} info\n   * @returns {void}\n   * @private\n   * @memberof RecordingController\n   */\n  private initialize(request: MeetingRequest) {\n    this.request = request;\n  }\n\n  /**\n   * @param {Object} options\n   * @returns {void}\n   * @public\n   * @memberof RecordingController\n   */\n  public set(options?: {\n    serviceUrl?: string;\n    sessionId: string;\n    locusUrl: string;\n    displayHints?: Array<string>;\n  }) {\n    this.extract(options);\n  }\n\n  /**\n   * @param {string} url\n   * @returns {void}\n   * @public\n   * @memberof RecordingController\n   */\n  public setLocusUrl(url: string) {\n    this.locusUrl = url;\n    this.locusId = Util.extractLocusId(this.locusUrl);\n  }\n\n  /**\n   * @param {Array} hints\n   * @returns {void}\n   * @public\n   * @memberof RecordingController\n   */\n  public setDisplayHints(hints: Array<string>) {\n    this.displayHints = hints;\n  }\n\n  /**\n   * @param {string} id\n   * @returns {void}\n   * @public\n   * @memberof RecordingController\n   */\n  public setSessionId(id: string) {\n    this.sessionId = id;\n  }\n\n  /**\n   * @param {string} url\n   * @returns {void}\n   * @public\n   * @memberof RecordingController\n   */\n  public setServiceUrl(url: string) {\n    this.serviceUrl = url;\n  }\n\n  /**\n   * @returns {string}\n   * @public\n   * @memberof RecordingController\n   */\n  public getLocusUrl() {\n    return this.locusUrl;\n  }\n\n  /**\n   * @returns {string}\n   * @public\n   * @memberof RecordingController\n   */\n  public getLocusId() {\n    return this.locusId;\n  }\n\n  /**\n   * @returns {string}\n   * @public\n   * @memberof RecordingController\n   */\n  public getSessionId() {\n    return this.sessionId;\n  }\n\n  /**\n   * @returns {string}\n   * @public\n   * @memberof RecordingController\n   */\n  public getServiceUrl() {\n    return this.serviceUrl;\n  }\n\n  /**\n   * @returns {Array}\n   * @public\n   * @memberof RecordingController\n   */\n  public getDisplayHints() {\n    return this.displayHints;\n  }\n\n  /**\n   * @param {Object} options\n   * @returns {void}\n   * @private\n   * @memberof RecordingController\n   */\n  private extract(options?: {\n    serviceUrl?: string;\n    sessionId: string;\n    locusUrl: string;\n    displayHints?: Array<string>;\n  }) {\n    this.setServiceUrl(options?.serviceUrl);\n    this.setSessionId(options?.sessionId);\n    this.setDisplayHints(options?.displayHints);\n    this.setLocusUrl(options?.locusUrl);\n  }\n\n  /**\n   * @param {RecordingAction} action\n   * @private\n   * @memberof RecordingController\n   * @returns {Promise}\n   */\n  private recordingService(action: RecordingAction): Promise<any> {\n    // @ts-ignore\n    return this.request.request({\n      body: {\n        meetingInfo: {\n          locusSessionId: this.sessionId,\n        },\n        recording: {\n          action: action.toLowerCase(),\n        },\n      },\n      uri: `${this.serviceUrl}/loci/${this.locusId}/recording`,\n      method: HTTP_VERBS.PUT,\n    });\n  }\n\n  /**\n   * @param {RecordingAction} action\n   * @private\n   * @memberof RecordingController\n   * @returns {Promise}\n   */\n  private recordingControls(action: RecordingAction): Promise<any> {\n    const record = Util.deriveRecordingStates(action);\n\n    LoggerProxy.logger.log(`RecordingController:index#recordingControls --> ${record}`);\n\n    // @ts-ignore\n    return this.request.request({\n      uri: `${this.locusUrl}/${CONTROLS}`,\n      body: {\n        record,\n      },\n      method: HTTP_VERBS.PATCH,\n    });\n  }\n\n  /**\n   * @param {RecordingAction} action\n   * @private\n   * @memberof RecordingController\n   * @returns {Promise}\n   */\n  private recordingFacade(action: RecordingAction): Promise<any> {\n    LoggerProxy.logger.log(\n      `RecordingController:index#recordingFacade --> recording action [${action}]`\n    );\n\n    // assumes action is proper cased (i.e., Example)\n    if (Util?.[`canUser${action}`](this.displayHints)) {\n      if (this.serviceUrl) {\n        return this.recordingService(action);\n      }\n\n      return this.recordingControls(action);\n    }\n\n    return Promise.reject(\n      new PermissionError(`${action} recording not allowed, due to moderator property.`)\n    );\n  }\n\n  /**\n   * @private\n   * @memberof RecordingController\n   * @returns {Promise}\n   */\n  public startRecording(): Promise<any> {\n    return this.recordingFacade(RecordingAction.Start);\n  }\n\n  /**\n   * @private\n   * @memberof RecordingController\n   * @returns {Promise}\n   */\n  public stopRecording(): Promise<any> {\n    return this.recordingFacade(RecordingAction.Stop);\n  }\n\n  /**\n   * @private\n   * @memberof RecordingController\n   * @returns {Promise}\n   */\n  public pauseRecording(): Promise<any> {\n    return this.recordingFacade(RecordingAction.Pause);\n  }\n\n  /**\n   * @private\n   * @memberof RecordingController\n   * @returns {Promise}\n   */\n  public resumeRecording(): Promise<any> {\n    return this.recordingFacade(RecordingAction.Resume);\n  }\n}\n"],"mappings":"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"}