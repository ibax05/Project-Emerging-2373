{"version":3,"names":["_constants","require","_loggerProxy","_interopRequireDefault","_collection","_request","_util","MeetingInfo","webex","_classCallCheck2","default","_defineProperty2","meetingInfoRequest","MeetingInfoRequest","meetingInfoCollection","MeetingInfoCollection","_createClass2","key","value","getMeetingInfo","id","get","setMeetingInfo","info","set","requestFetchInfo","options","_this","fetchMeetingInfo","then","body","sipMeetingUri","meetingLink","catch","error","LoggerProxy","logger","concat","_promise","reject","fetchInfoOptions","destination","type","MeetingInfoUtil","generateOptions","_this2","arguments","length","undefined","_PERSONAL_ROOM_","internal","device","userId","extractDestination","_MEETING_LINK_","convertLinkToSip","_SIP_URI_","exports"],"sources":["index.ts"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {_MEETING_LINK_, _SIP_URI_, _PERSONAL_ROOM_} from '../constants';\nimport LoggerProxy from '../common/logs/logger-proxy';\n\nimport MeetingInfoCollection from './collection';\nimport MeetingInfoRequest from './request';\nimport MeetingInfoUtil from './util';\n\n/**\n * @class MeetingInfo\n */\nexport default class MeetingInfo {\n  meetingInfoCollection: any;\n  meetingInfoRequest: any;\n  webex: any;\n\n  /**\n   *\n   * @param {WebexSDK} webex\n   */\n  constructor(webex: any) {\n    this.webex = webex;\n\n    /**\n     * The meeting info request server interface\n     * @instance\n     * @type {Object}\n     * @private\n     * @memberof MeetingInfo\n     */\n    this.meetingInfoRequest = new MeetingInfoRequest(this.webex);\n    /**\n     * The meeting information collection interface\n     * @instance\n     * @type {Object}\n     * @private\n     * @memberof MeetingInfo\n     */\n    this.meetingInfoCollection = new MeetingInfoCollection();\n  }\n\n  /**\n   * @param {string} id\n   * @returns {object}\n   * @public\n   * @memberof MeetingInfo\n   */\n  public getMeetingInfo(id: string) {\n    return this.meetingInfoCollection.get(id);\n  }\n\n  /**\n   * @param {string} id\n   * @param {object} info\n   * @returns {null}\n   * @public\n   * @memberof MeetingInfo\n   */\n  public setMeetingInfo(id: string, info: object) {\n    this.meetingInfoCollection.set(id, info);\n  }\n\n  /**\n   * Helper to make the actual MeetingInfo request and set the meetingInfo if successful, else reject\n   * @param {Object} options\n   * @returns {Promise}\n   * @private\n   * @memberof MeetingInfo\n   */\n  private requestFetchInfo(options: object) {\n    return this.meetingInfoRequest\n      .fetchMeetingInfo(options)\n      .then((info) => {\n        if (info && info.body) {\n          this.setMeetingInfo(info.body.sipMeetingUri || info.body.meetingLink, info.body);\n        }\n\n        return info;\n      })\n      .catch((error) => {\n        LoggerProxy.logger.error(\n          `Meeting-info:index#requestFetchInfo -->  ${error} fetch meetingInfo`\n        );\n\n        return Promise.reject(error);\n      });\n  }\n\n  /**\n   * Helper to generate the options for the MeetingInfo request\n   * @param {String} destination\n   * @param {String} type\n   * @returns {Promise}\n   * @private\n   * @memberof MeetingInfo\n   */\n  private fetchInfoOptions(destination: string, type: string) {\n    return MeetingInfoUtil.generateOptions({\n      destination,\n      type,\n      webex: this.webex,\n    });\n  }\n\n  /**\n   * Fetches meeting info from the server\n   * @param {String} destination one of many different types of destinations to look up info for\n   * @param {String} [type] to match up with the destination value\n   * @returns {Promise} returns a meeting info object\n   * @public\n   * @memberof MeetingInfo\n   */\n  public fetchMeetingInfo(destination: string, type: string = null) {\n    if (type === _PERSONAL_ROOM_ && !destination) {\n      destination = this.webex.internal.device.userId;\n    }\n\n    return this.fetchInfoOptions(MeetingInfoUtil.extractDestination(destination, type), type).then(\n      (options) =>\n        // fetch meeting info\n        this.requestFetchInfo(options).catch((error) => {\n          // if it failed the first time as meeting link\n          if (options.type === _MEETING_LINK_) {\n            // convert the meeting link to sip URI and retry\n            return this.requestFetchInfo(\n              this.fetchInfoOptions(MeetingInfoUtil.convertLinkToSip(destination), _SIP_URI_)\n            );\n          }\n\n          return Promise.reject(error);\n        })\n    );\n  }\n}\n"],"mappings":"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"}