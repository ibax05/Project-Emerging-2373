{"version":3,"names":["_uuid","require","_createForOfIteratorHelper","o","allowArrayLike","it","_Symbol","_Symbol$iterator","_Array$isArray","_unsupportedIterableToArray","length","i","F","s","n","done","value","e","_e","f","TypeError","normalCompletion","didErr","err","call","step","next","_e2","return","minLen","_arrayLikeToArray","Object","prototype","toString","slice","constructor","name","_Array$from","test","arr","len","arr2","Array","Transcription","webSocketUrl","sessionId","members","_classCallCheck2","default","_defineProperty2","sessionID","memberCSIs","params","webSocket","WebSocket","concat","_createClass2","key","connect","token","_this","onopen","send","_stringify","id","uuidv4","type","data","trackingId","_now","onCloseSocket","callback","onclose","event","onErrorSocket","onerror","getSpeaker","csis","_this2","_iterator","_step","csi","member","_values","membersCollection","find","participant","status","selfIsSpeaking","_iterator2","_step2","includes","subscribe","_this3","speaker","transcription","onmessage","_data$data","_data$data$voiceaPayl","_data$data2","_data$data2$voiceaPay","JSON","parse","voiceaPayload","messageID","_data$data3","_data$data3$voiceaPay","_speaker","_data","_data$data4","_data$data4$voiceaPay","transcript_id","personID","timestamp","closeSocket","close","exports"],"sources":["index.ts"],"sourcesContent":["import {v4 as uuidv4} from 'uuid';\n\n/**\n * @description Meeting Webex assistance transcription feature.\n * @exports\n * @class Transcription\n */\nexport default class Transcription {\n  webSocketUrl: any;\n  sessionID: any;\n  members: any;\n  memberCSIs: any;\n  webSocket: any;\n\n  /**\n   * @param {string} webSocketUrl\n   * @param {sessionID} sessionId\n   * @param {object} members\n   * @constructor\n   * @memberof Transcription\n   */\n  constructor(webSocketUrl: string, sessionId: any, members: object) {\n    this.webSocketUrl = webSocketUrl;\n    this.sessionID = sessionId;\n    this.members = members;\n    this.memberCSIs = {};\n\n    const params = '?outboundWireFormat=text&bufferStates=true&aliasHttpStatus=true';\n\n    this.webSocket = new WebSocket(`${this.webSocketUrl}${params}`);\n  }\n\n  /**\n   * open the Low Latency Mercury connection\n   * An event parameter will be send to the callback.\n   *\n   * @param {string} token\n   * @param {string} sessionID\n   * @returns {void}\n   */\n  connect(token: string) {\n    this.webSocket.onopen = () => {\n      this.webSocket.send(\n        JSON.stringify({\n          id: uuidv4(),\n          type: 'authorization',\n          data: {token: `Bearer ${token}`},\n          trackingId: `webex-js-sdk_${this.sessionID}${Date.now.toString()}`,\n        })\n      );\n    };\n  }\n\n  /**\n   * Sets callback to invoke when the web socket connection is closed.\n   *\n   * @param {Function} callback\n   * @returns {void}\n   */\n  onCloseSocket(callback: any) {\n    if (callback) {\n      this.webSocket.onclose = (event) => {\n        callback(event);\n      };\n    }\n  }\n\n  /**\n   * Sets callback to invoke when a web socket connection error occurs.\n   * An event parameter will be send to the callback.\n   *\n   * @param {Function} callback\n   * @returns {void}\n   */\n  onErrorSocket(callback: any) {\n    if (callback) {\n      this.webSocket.onerror = (event) => {\n        callback(event);\n      };\n    }\n  }\n\n  /**\n   * Get current speaker from the given csis payload and update the global csis map\n   *\n   * @private\n   * @param {object} csis\n   * @returns {object}\n   */\n  private getSpeaker(csis: any) {\n    for (const csi of csis) {\n      const member = this.memberCSIs[csi];\n\n      if (member) {\n        return member;\n      }\n    }\n\n    return Object.values(this.members.membersCollection.members).find((member: any) => {\n      const memberCSIs = member.participant.status.csis;\n      let selfIsSpeaking = false;\n\n      for (const csi of csis) {\n        if (memberCSIs.includes(csi)) {\n          this.memberCSIs[csi] = member;\n          selfIsSpeaking = true;\n          break;\n        }\n      }\n\n      return selfIsSpeaking;\n    });\n  }\n\n  /**\n   * Sends transcription data to given callback as it arrives.\n   *\n   * @param {Function} callback\n   * @returns {void}\n   */\n  subscribe(callback: any) {\n    let data;\n    let csis;\n    let speaker;\n    let transcription;\n\n    this.webSocket.onmessage = (event) => {\n      data = JSON.parse(event.data);\n      csis = data.data?.voiceaPayload?.csis || [];\n      speaker = this.getSpeaker(csis);\n      transcription = data.data?.voiceaPayload?.data || '';\n\n      this.webSocket.send(JSON.stringify({messageID: data.id, type: 'ack'}));\n\n      if (transcription) {\n        callback({\n          id: data.data?.voiceaPayload?.transcript_id,\n          personID: speaker?.id,\n          transcription,\n          timestamp: data.timestamp,\n          type: data?.data?.voiceaPayload?.type,\n        });\n      }\n    };\n  }\n\n  /**\n   * Close the LLM web socket connection\n   * @returns {void}\n   */\n  closeSocket() {\n    this.webSocket.close();\n  }\n}\n"],"mappings":"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"}