{"version":3,"names":["_permission","_interopRequireDefault","require","_constants","_loggerProxy","_enums","_util","_constants2","ControlsOptionsManager","request","options","_classCallCheck2","default","_defineProperty2","initialize","set","_createClass2","key","value","extract","setLocusUrl","url","locusUrl","setDisplayHints","hints","displayHints","getLocusUrl","getDisplayHints","setControls","setting","enabled","LoggerProxy","logger","log","concat","Util","CAN_SET","CAN_UNSET","uri","CONTROLS","body","_camelCase3","ENABLED","method","HTTP_VERBS","PATCH","_promise","reject","PermissionError","setMuteOnEntry","Setting","muteOnEntry","setDisallowUnmute","disallowUnmute","exports"],"sources":["index.ts"],"sourcesContent":["import {camelCase} from 'lodash';\nimport PermissionError from '../common/errors/permission';\nimport {CONTROLS, HTTP_VERBS} from '../constants';\nimport MeetingRequest from '../meeting/request';\nimport LoggerProxy from '../common/logs/logger-proxy';\nimport Setting from './enums';\nimport Util from './util';\nimport {CAN_SET, CAN_UNSET, ENABLED} from './constants';\n\n/**\n * docs\n * https://sqbu-github.cisco.com/pages/WebExSquared/locus/guides/mute.html\n * https://confluence-eng-gpk2.cisco.com/conf/display/LOCUS/Hard+Mute+and+Audio+Privacy#HardMuteandAudioPrivacy-SelfMuteonEntry\n * https://confluence-eng-gpk2.cisco.com/conf/pages/viewpage.action?spaceKey=UC&title=WEBEX-124454%3A+UCF%3A+Hard+mute+support+for+Teams+joining+Webex+meeting\n * https://jira-eng-gpk2.cisco.com/jira/browse/SPARK-180867\n * https://jira-eng-gpk2.cisco.com/jira/browse/SPARK-393351\n */\n\n/**\n * @description ControlsOptionsManager is responsible for handling the behavior of participant controls when somebody joins a meeting\n * @export\n * @private\n * @class Recording\n */\nexport default class ControlsOptionsManager {\n  /**\n   * @instance\n   * @type {MeetingRequest}\n   * @private\n   * @memberof ControlsOptionsManager\n   */\n  private request: MeetingRequest;\n\n  /**\n   * @instance\n   * @type {Array}\n   * @private\n   * @memberof ControlsOptionsManager\n   */\n  private displayHints: Array<string> = [];\n\n  /**\n   * @instance\n   * @type {string}\n   * @private\n   * @memberof ControlsOptionsManager\n   */\n  private locusUrl: string;\n\n  /**\n   * @param {MeetingRequest} request\n   * @param {Object} options\n   * @constructor\n   * @memberof ControlsOptionsManager\n   */\n  constructor(\n    request: MeetingRequest,\n    options?: {\n      locusUrl: string;\n      displayHints?: Array<string>;\n    }\n  ) {\n    this.initialize(request);\n    this.set(options);\n  }\n\n  /**\n   * @param {MeetingRequest} request\n   * @returns {void}\n   * @private\n   * @memberof ControlsOptionsManager\n   */\n  private initialize(request: MeetingRequest) {\n    this.request = request;\n  }\n\n  /**\n   * @param {Object} options\n   * @returns {void}\n   * @public\n   * @memberof ControlsOptionsManager\n   */\n  public set(options?: {locusUrl: string; displayHints?: Array<string>}) {\n    this.extract(options);\n  }\n\n  /**\n   * @param {string} url\n   * @returns {void}\n   * @public\n   * @memberof ControlsOptionsManager\n   */\n  public setLocusUrl(url: string) {\n    this.locusUrl = url;\n  }\n\n  /**\n   * @param {Array} hints\n   * @returns {void}\n   * @public\n   * @memberof ControlsOptionsManager\n   */\n  public setDisplayHints(hints: Array<string>) {\n    this.displayHints = hints;\n  }\n\n  /**\n   * @returns {string}\n   * @public\n   * @memberof ControlsOptionsManager\n   */\n  public getLocusUrl() {\n    return this.locusUrl;\n  }\n\n  /**\n   * @returns {Array}\n   * @public\n   * @memberof ControlsOptionsManager\n   */\n  public getDisplayHints() {\n    return this.displayHints;\n  }\n\n  /**\n   * @param {Object} options\n   * @returns {void}\n   * @private\n   * @memberof ControlsOptionsManager\n   */\n  private extract(options?: {locusUrl: string; displayHints?: Array<string>}) {\n    this.setDisplayHints(options?.displayHints);\n    this.setLocusUrl(options?.locusUrl);\n  }\n\n  /**\n   * @param {Setting} setting\n   * @param {boolean} enabled\n   * @private\n   * @memberof ControlsOptionsManager\n   * @returns {Promise}\n   */\n  private setControls(setting: Setting, enabled: boolean): Promise<any> {\n    LoggerProxy.logger.log(`ControlsOptionsManager:index#setControls --> ${setting} [${enabled}]`);\n\n    if (Util?.[`${enabled ? CAN_SET : CAN_UNSET}${setting}`](this.displayHints)) {\n      // @ts-ignore\n      return this.request.request({\n        uri: `${this.locusUrl}/${CONTROLS}`,\n        body: {\n          [camelCase(setting)]: {\n            [ENABLED]: enabled,\n          },\n        },\n        method: HTTP_VERBS.PATCH,\n      });\n    }\n\n    return Promise.reject(\n      new PermissionError(`${setting} [${enabled}] not allowed, due to moderator property.`)\n    );\n  }\n\n  /**\n   * @public\n   * @param {boolean} enabled\n   * @memberof ControlsOptionsManager\n   * @returns {Promise}\n   */\n  public setMuteOnEntry(enabled: boolean): Promise<any> {\n    return this.setControls(Setting.muteOnEntry, enabled);\n  }\n\n  /**\n   * @public\n   * @param {boolean} enabled\n   * @memberof ControlsOptionsManager\n   * @returns {Promise}\n   */\n  public setDisallowUnmute(enabled: boolean): Promise<any> {\n    return this.setControls(Setting.disallowUnmute, enabled);\n  }\n}\n"],"mappings":"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"}