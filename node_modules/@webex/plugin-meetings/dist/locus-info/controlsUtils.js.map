{"version":3,"names":["ControlsUtils","parse","controls","parsedControls","_objectSpread","record","modifiedBy","getId","paused","recording","lastModified","meta","meetingContainer","meetingContainerUrl","transcribe","transcribing","caption","entryExitTone","enabled","mode","getControls","oldControls","newControls","_previous$record","_previous$record2","_current$record","_previous$record3","_current$record2","_previous$record4","_current$record3","_previous$meetingCont","_current$meetingConta","_previous$transcribe","_current$transcribe","_previous$transcribe2","_current$transcribe2","previous","current","updates","hasRecordingPausedChanged","_isEqual2","default","hasRecordingChanged","hasMeetingContainerChanged","hasTranscribeChanged","hasEntryExitToneChanged","_default","exports"],"sources":["controlsUtils.ts"],"sourcesContent":["import {isEqual} from 'lodash';\n\nconst ControlsUtils: any = {};\n\n/**\n * Controls\n * @typedef {Object} LocusControls\n * @property {Object} record\n * @property {Boolean} record.recording\n * @property {Object} record.meta\n * @property {String} record.meta.modifiedBy\n */\n\n/**\n * parse the relevant host values that we care about: id\n * @param {LocusControls} controls\n * @returns {Object} parsedObject - parsed host or null if host was undefined\n * @returns {String} parsedObject.recordingId\n */\nControlsUtils.parse = (controls: any) => {\n  const parsedControls = {...controls};\n\n  if (controls && controls.record) {\n    parsedControls.record = {\n      modifiedBy: ControlsUtils.getId(controls),\n      paused: controls.record.paused ? controls.record.paused : false,\n      recording: controls.record.recording,\n      lastModified: controls.record.meta.lastModified,\n    };\n  }\n\n  if (controls && controls.meetingContainer) {\n    parsedControls.meetingContainer = {\n      meetingContainerUrl: controls.meetingContainer.meetingContainerUrl,\n    };\n  }\n\n  if (controls && controls.transcribe) {\n    parsedControls.transcribe = {\n      transcribing: controls.transcribe.transcribing,\n      caption: controls.transcribe.caption,\n    };\n  }\n\n  if (controls && controls.entryExitTone) {\n    parsedControls.entryExitTone = controls.entryExitTone.enabled\n      ? controls.entryExitTone.mode\n      : null;\n  }\n\n  return parsedControls;\n};\n\n/**\n * parses and returns previous state vs current state and triggers the changes.\n * @param {LocusControls} oldControls previous state\n * @param {LocusControls} newControls current state\n * @returns {Object} combination of state plus the changes\n */\nControlsUtils.getControls = (oldControls: any, newControls: any) => {\n  const previous = ControlsUtils.parse(oldControls);\n  const current = ControlsUtils.parse(newControls);\n\n  return {\n    previous,\n    current,\n    updates: {\n      hasRecordingPausedChanged:\n        current?.record &&\n        !isEqual(previous?.record?.paused, current.record.paused) &&\n        (previous?.record?.recording || current?.record?.recording), // see comments directly below\n\n      hasRecordingChanged:\n        current?.record &&\n        !isEqual(previous?.record?.recording, current?.record?.recording) && // upon first join, previous?.record?.recording = undefined; thus, never going to be equal and will always return true\n        (previous?.record?.recording || current?.record?.recording), // therefore, condition added to prevent false firings of #meeting:recording:stopped upon first joining a meeting\n\n      hasMeetingContainerChanged:\n        current?.meetingContainer &&\n        !isEqual(\n          previous?.meetingContainer?.meetingContainerUrl,\n          current?.meetingContainer?.meetingContainerUrl\n        ),\n\n      hasTranscribeChanged:\n        current?.transcribe &&\n        !isEqual(previous?.transcribe?.transcribing, current?.transcribe?.transcribing) && // upon first join, previous?.record?.recording = undefined; thus, never going to be equal and will always return true\n        (previous?.transcribe?.transcribing || current?.transcribe?.transcribing), // therefore, condition added to prevent false firings of #meeting:recording:stopped upon first joining a meeting\n\n      hasEntryExitToneChanged: !!(\n        newControls.entryExitTone &&\n        !isEqual(previous?.entryExitTone, current?.entryExitTone) &&\n        (previous?.entryExitTone || current?.entryExitTone)\n      ),\n    },\n  };\n};\n\n/**\n * Extract the id from the record controls object\n * @param {LocusControls} controls\n * @returns {String|null}\n */\nControlsUtils.getId = (controls: any) => {\n  if (controls.record.meta) {\n    return controls.record.meta.modifiedBy;\n  }\n\n  return null;\n};\n\nexport default ControlsUtils;\n"],"mappings":"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"}