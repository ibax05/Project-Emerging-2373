{"version":3,"names":["_state","_interopRequireDefault","require","RoapCollection","sessions","getSession","id","activeSequences","deleteSession","getSessionSequence","seqId","session","state","RoapStateMachine","createState","finished","deleteSessionSequence","seq","isBusy","onSessionSequenceFinish","_default","exports","default"],"sources":["collection.ts"],"sourcesContent":["import RoapStateMachine from './state';\n\n/* eslint-disable */\nconst RoapCollection = {\n  sessions: {},\n\n  getSession(id) {\n    if (!this.sessions[id]) {\n      this.sessions[id] = {\n        activeSequences: 0,\n      };\n    }\n    return this.sessions[id];\n  },\n\n  deleteSession(id) {\n    if (this.getSession(id)) {\n      delete this.sessions[id];\n    }\n  },\n\n  getSessionSequence(id, seqId) {\n    const session = this.getSession(id);\n    if (!session[seqId]) {\n      session[seqId] = {\n        state: RoapStateMachine.createState(),\n        finished: false,\n      };\n      session.activeSequences += 1;\n    }\n    return session[seqId];\n  },\n\n  deleteSessionSequence(id, seqId) {\n    const seq = this.getSessionSequence(id, seqId);\n    if (seq) {\n      if (!seq.finished) {\n        // @ts-ignore\n        session.activeSequences -= 1;\n      }\n      delete this.sessions[id][seqId];\n    }\n  },\n\n  isBusy(id) {\n    const session = this.getSession(id);\n    if (!session) return false;\n\n    return session.activeSequences > 0;\n  },\n\n  onSessionSequenceFinish(id, seqId) {\n    const session = this.getSession(id);\n    const seq = session[seqId];\n    if (seq && !seq.finished) {\n      seq.finished = true;\n      session.activeSequences -= 1;\n    }\n  },\n};\n\nexport default RoapCollection;\n"],"mappings":";;;;;;;;AAAA,IAAAA,MAAA,GAAAC,sBAAA,CAAAC,OAAA;AAEA;AACA,IAAMC,cAAc,GAAG;EACrBC,QAAQ,EAAE,CAAC,CAAC;EAEZC,UAAU,WAAAA,WAACC,EAAE,EAAE;IACb,IAAI,CAAC,IAAI,CAACF,QAAQ,CAACE,EAAE,CAAC,EAAE;MACtB,IAAI,CAACF,QAAQ,CAACE,EAAE,CAAC,GAAG;QAClBC,eAAe,EAAE;MACnB,CAAC;IACH;IACA,OAAO,IAAI,CAACH,QAAQ,CAACE,EAAE,CAAC;EAC1B,CAAC;EAEDE,aAAa,WAAAA,cAACF,EAAE,EAAE;IAChB,IAAI,IAAI,CAACD,UAAU,CAACC,EAAE,CAAC,EAAE;MACvB,OAAO,IAAI,CAACF,QAAQ,CAACE,EAAE,CAAC;IAC1B;EACF,CAAC;EAEDG,kBAAkB,WAAAA,mBAACH,EAAE,EAAEI,KAAK,EAAE;IAC5B,IAAMC,OAAO,GAAG,IAAI,CAACN,UAAU,CAACC,EAAE,CAAC;IACnC,IAAI,CAACK,OAAO,CAACD,KAAK,CAAC,EAAE;MACnBC,OAAO,CAACD,KAAK,CAAC,GAAG;QACfE,KAAK,EAAEC,cAAgB,CAACC,WAAW,EAAE;QACrCC,QAAQ,EAAE;MACZ,CAAC;MACDJ,OAAO,CAACJ,eAAe,IAAI,CAAC;IAC9B;IACA,OAAOI,OAAO,CAACD,KAAK,CAAC;EACvB,CAAC;EAEDM,qBAAqB,WAAAA,sBAACV,EAAE,EAAEI,KAAK,EAAE;IAC/B,IAAMO,GAAG,GAAG,IAAI,CAACR,kBAAkB,CAACH,EAAE,EAAEI,KAAK,CAAC;IAC9C,IAAIO,GAAG,EAAE;MACP,IAAI,CAACA,GAAG,CAACF,QAAQ,EAAE;QACjB;QACAJ,OAAO,CAACJ,eAAe,IAAI,CAAC;MAC9B;MACA,OAAO,IAAI,CAACH,QAAQ,CAACE,EAAE,CAAC,CAACI,KAAK,CAAC;IACjC;EACF,CAAC;EAEDQ,MAAM,WAAAA,OAACZ,EAAE,EAAE;IACT,IAAMK,OAAO,GAAG,IAAI,CAACN,UAAU,CAACC,EAAE,CAAC;IACnC,IAAI,CAACK,OAAO,EAAE,OAAO,KAAK;IAE1B,OAAOA,OAAO,CAACJ,eAAe,GAAG,CAAC;EACpC,CAAC;EAEDY,uBAAuB,WAAAA,wBAACb,EAAE,EAAEI,KAAK,EAAE;IACjC,IAAMC,OAAO,GAAG,IAAI,CAACN,UAAU,CAACC,EAAE,CAAC;IACnC,IAAMW,GAAG,GAAGN,OAAO,CAACD,KAAK,CAAC;IAC1B,IAAIO,GAAG,IAAI,CAACA,GAAG,CAACF,QAAQ,EAAE;MACxBE,GAAG,CAACF,QAAQ,GAAG,IAAI;MACnBJ,OAAO,CAACJ,eAAe,IAAI,CAAC;IAC9B;EACF;AACF,CAAC;AAAC,IAAAa,QAAA,GAEajB,cAAc;AAAAkB,OAAA,CAAAC,OAAA,GAAAF,QAAA"}