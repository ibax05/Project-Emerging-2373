{"version":3,"names":["_webexCore","require","_loggerProxy","_interopRequireDefault","_constants","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf2","default","result","NewTarget","constructor","_Reflect$construct","arguments","apply","_possibleConstructorReturn2","Reflect","sham","Proxy","Boolean","prototype","valueOf","call","e","MeetingRequest","_StatelessWebexPlugin","_inherits2","_super","_classCallCheck2","_createClass2","key","value","getActiveMeetings","_this","request","api","API","LOCUS","resource","RESOURCE","LOCI","then","res","determineRedirections","body","catch","error","LoggerProxy","logger","concat","fetchGeoHint","webex","internal","services","fetchClientRegionInfo","getMeetingPreferences","responseBody","_this2","remoteLocusClusterUrls","length","_promise","all","map","url","method","HTTP_VERBS","GET","runWhitelistedDomains","loci","locusUrls","resolve","StatelessWebexPlugin","exports"],"sources":["request.ts"],"sourcesContent":["// @ts-ignore\nimport {StatelessWebexPlugin} from '@webex/webex-core';\n\nimport LoggerProxy from '../common/logs/logger-proxy';\nimport {HTTP_VERBS, API, RESOURCE} from '../constants';\n\n/**\n * @class MeetingRequest\n */\nexport default class MeetingRequest extends StatelessWebexPlugin {\n  /**\n   *  get all the active meetings for the user\n   * @returns {Array} return locus array\n   */\n  getActiveMeetings() {\n    // @ts-ignore\n    return this.request({\n      api: API.LOCUS,\n      resource: RESOURCE.LOCI,\n    })\n      .then((res) => this.determineRedirections(res.body))\n      .catch((error) => {\n        LoggerProxy.logger.error(\n          `Meetings:request#getActiveMeetings --> failed to get locus details, ${error}`\n        );\n      });\n  }\n\n  /**\n   *  fetch geoHit for the user\n   * @returns {Promise<object>} geoHintInfo\n   */\n  fetchGeoHint() {\n    // @ts-ignore\n    return this.webex.internal.services.fetchClientRegionInfo();\n  }\n\n  /**\n   * get user meeting preference information\n   * @returns {Promise<object>} getMeetingPreferences\n   */\n  getMeetingPreferences() {\n    // @ts-ignore\n    return this.webex.internal.services.getMeetingPreferences();\n  }\n\n  // locus federation, determines and populate locus if the responseBody has remote URLs to fetch locus details\n\n  /**\n   *  Fetches indivdual locus rather then getting all at once\n   * @param {object} responseBody determine the locus and fetch them if a remoteUrl is given\n   * @returns {Promise}  returns locusObject array\n   */\n  determineRedirections(responseBody: any) {\n    if (responseBody.remoteLocusClusterUrls && responseBody.remoteLocusClusterUrls.length) {\n      return Promise.all(\n        responseBody.remoteLocusClusterUrls.map((url) =>\n          // @ts-ignore\n          this.request({\n            method: HTTP_VERBS.GET,\n            url,\n            runWhitelistedDomains: true, // allows auth token for whitelisted domain\n          })\n            .then((res) => {\n              responseBody.loci = responseBody.loci.concat(res.body.loci);\n              responseBody.locusUrls = responseBody.locusUrls.concat(res.body.locusUrls);\n\n              return Promise.resolve(responseBody);\n            })\n            .catch((error) => {\n              LoggerProxy.logger.error(\n                `Meetings:request#determineRedirections --> failed to get locus details from url: ${url}, reason: ${error}`\n              );\n            })\n        )\n      ).then(() => Promise.resolve(responseBody));\n    }\n\n    return Promise.resolve(responseBody);\n  }\n}\n"],"mappings":"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"}