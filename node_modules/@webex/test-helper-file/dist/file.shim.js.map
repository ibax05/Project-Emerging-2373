{"version":3,"names":["makeLocalUrl","require","xhr","convertBlobToArrayBuffer","blob","Blob","Error","_promise","default","resolve","reject","reader","FileReader","onerror","onload","result","readAsArrayBuffer","convertUint8ArrayToArrayBuffer","array","Uint8Array","buffer","isBlobLike","file","isBufferLike","ArrayBuffer","ensureArrayBuffer","fetch","filename","uri","concat","responseType","err","res","body","name","FileShim","fetchWithoutMagic","isMatchingFile","left","right","all","then","buffers","innerLeft","innerRight","byteLength","l","r","i","length","module","exports"],"sources":["file.shim.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\n/* eslint-env browser */\n\nconst makeLocalUrl = require('@webex/test-helper-make-local-url');\nconst xhr = require('xhr');\n\n/**\n * @param {Blob} blob\n * @private\n * @returns {Promise}\n */\nfunction convertBlobToArrayBuffer(blob) {\n  if (!(blob instanceof Blob)) {\n    throw new Error('`blob` must be a `Blob`');\n  }\n\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n\n    reader.onerror = reject;\n    reader.onload = function onload() {\n      resolve(reader.result);\n    };\n\n    reader.readAsArrayBuffer(blob);\n  });\n}\n\n/**\n * @param {Uint8Array} array\n * @private\n * @returns {ArrayBuffer}\n */\nfunction convertUint8ArrayToArrayBuffer(array) {\n  if (!(array instanceof Uint8Array)) {\n    throw new Error('`array` must be a `Uint8Array`');\n  }\n\n  return array.buffer;\n}\n\n/**\n * @param {mixed} file\n * @returns {Boolean}\n */\nfunction isBlobLike(file) {\n  return file instanceof Blob && 'size' in file && 'type' in file;\n}\n\n/**\n * @param {mixed} file\n * @returns {Boolean}\n */\nfunction isBufferLike(file) {\n  return file instanceof ArrayBuffer;\n}\n\n/**\n * @param {mixed} file\n * @private\n * @returns {Promise}\n */\nfunction ensureArrayBuffer(file) {\n  if (isBufferLike(file)) {\n    return file;\n  }\n\n  if (isBlobLike(file)) {\n    return convertBlobToArrayBuffer(file);\n  }\n\n  if (file instanceof Uint8Array) {\n    return convertUint8ArrayToArrayBuffer(file);\n  }\n\n  throw new Error('Could not determine type of `file`');\n}\n\n/**\n * Fetches a file\n * @param {string} filename\n * @returns {Promise<File>}\n */\nfunction fetch(filename) {\n  return new Promise((resolve, reject) => {\n    xhr(\n      {\n        uri: makeLocalUrl(`/${filename}`),\n        responseType: 'blob',\n      },\n      (err, res, body) => {\n        if (err) {\n          reject(err);\n        } else {\n          body.name = body.name || filename;\n          resolve(body);\n        }\n      }\n    );\n  });\n}\n\nconst FileShim = {\n  /**\n   * @param {string} filename\n   * @returns {Promise}\n   */\n  fetch,\n\n  fetchWithoutMagic: fetch,\n\n  isBufferLike,\n\n  isBlobLike,\n\n  /**\n   * @param {ArrayBuffer|Blob|Uint8Array} left\n   * @param {ArrayBuffer|Blob|Uint8Array} right\n   * @returns {Boolean}\n   */\n  isMatchingFile: function isMatchingFile(left, right) {\n    return Promise.all([ensureArrayBuffer(left), ensureArrayBuffer(right)]).then((buffers) => {\n      const innerLeft = buffers[0];\n      const innerRight = buffers[1];\n\n      if (!FileShim.isBufferLike(innerLeft)) {\n        throw new Error('`innerLeft` must be a `Buffer`');\n      }\n\n      if (!FileShim.isBufferLike(innerRight)) {\n        throw new Error('`innerRight` must be a `Buffer`');\n      }\n\n      if (innerLeft.byteLength !== innerRight.byteLength) {\n        return false;\n      }\n\n      const l = new Uint8Array(innerLeft);\n      const r = new Uint8Array(innerRight);\n\n      for (let i = 0; i < l.length; i += 1) {\n        if (l[i] !== r[i]) {\n          return false;\n        }\n      }\n\n      return true;\n    });\n  },\n};\n\nmodule.exports = FileShim;\n"],"mappings":";;;;AAAA;AACA;AACA;;AAEA;;AAEA,IAAMA,YAAY,GAAGC,OAAO,CAAC,mCAAmC,CAAC;AACjE,IAAMC,GAAG,GAAGD,OAAO,CAAC,KAAK,CAAC;;AAE1B;AACA;AACA;AACA;AACA;AACA,SAASE,wBAAwBA,CAACC,IAAI,EAAE;EACtC,IAAI,EAAEA,IAAI,YAAYC,IAAI,CAAC,EAAE;IAC3B,MAAM,IAAIC,KAAK,CAAC,yBAAyB,CAAC;EAC5C;EAEA,OAAO,IAAAC,QAAA,CAAAC,OAAA,CAAY,UAACC,OAAO,EAAEC,MAAM,EAAK;IACtC,IAAMC,MAAM,GAAG,IAAIC,UAAU,EAAE;IAE/BD,MAAM,CAACE,OAAO,GAAGH,MAAM;IACvBC,MAAM,CAACG,MAAM,GAAG,SAASA,MAAMA,CAAA,EAAG;MAChCL,OAAO,CAACE,MAAM,CAACI,MAAM,CAAC;IACxB,CAAC;IAEDJ,MAAM,CAACK,iBAAiB,CAACZ,IAAI,CAAC;EAChC,CAAC,CAAC;AACJ;;AAEA;AACA;AACA;AACA;AACA;AACA,SAASa,8BAA8BA,CAACC,KAAK,EAAE;EAC7C,IAAI,EAAEA,KAAK,YAAYC,UAAU,CAAC,EAAE;IAClC,MAAM,IAAIb,KAAK,CAAC,gCAAgC,CAAC;EACnD;EAEA,OAAOY,KAAK,CAACE,MAAM;AACrB;;AAEA;AACA;AACA;AACA;AACA,SAASC,UAAUA,CAACC,IAAI,EAAE;EACxB,OAAOA,IAAI,YAAYjB,IAAI,IAAI,MAAM,IAAIiB,IAAI,IAAI,MAAM,IAAIA,IAAI;AACjE;;AAEA;AACA;AACA;AACA;AACA,SAASC,YAAYA,CAACD,IAAI,EAAE;EAC1B,OAAOA,IAAI,YAAYE,WAAW;AACpC;;AAEA;AACA;AACA;AACA;AACA;AACA,SAASC,iBAAiBA,CAACH,IAAI,EAAE;EAC/B,IAAIC,YAAY,CAACD,IAAI,CAAC,EAAE;IACtB,OAAOA,IAAI;EACb;EAEA,IAAID,UAAU,CAACC,IAAI,CAAC,EAAE;IACpB,OAAOnB,wBAAwB,CAACmB,IAAI,CAAC;EACvC;EAEA,IAAIA,IAAI,YAAYH,UAAU,EAAE;IAC9B,OAAOF,8BAA8B,CAACK,IAAI,CAAC;EAC7C;EAEA,MAAM,IAAIhB,KAAK,CAAC,oCAAoC,CAAC;AACvD;;AAEA;AACA;AACA;AACA;AACA;AACA,SAASoB,KAAKA,CAACC,QAAQ,EAAE;EACvB,OAAO,IAAApB,QAAA,CAAAC,OAAA,CAAY,UAACC,OAAO,EAAEC,MAAM,EAAK;IACtCR,GAAG,CACD;MACE0B,GAAG,EAAE5B,YAAY,KAAA6B,MAAA,CAAKF,QAAQ,EAAG;MACjCG,YAAY,EAAE;IAChB,CAAC,EACD,UAACC,GAAG,EAAEC,GAAG,EAAEC,IAAI,EAAK;MAClB,IAAIF,GAAG,EAAE;QACPrB,MAAM,CAACqB,GAAG,CAAC;MACb,CAAC,MAAM;QACLE,IAAI,CAACC,IAAI,GAAGD,IAAI,CAACC,IAAI,IAAIP,QAAQ;QACjClB,OAAO,CAACwB,IAAI,CAAC;MACf;IACF,CAAC,CACF;EACH,CAAC,CAAC;AACJ;AAEA,IAAME,QAAQ,GAAG;EACf;AACF;AACA;AACA;EACET,KAAK,EAALA,KAAK;EAELU,iBAAiB,EAAEV,KAAK;EAExBH,YAAY,EAAZA,YAAY;EAEZF,UAAU,EAAVA,UAAU;EAEV;AACF;AACA;AACA;AACA;EACEgB,cAAc,EAAE,SAASA,cAAcA,CAACC,IAAI,EAAEC,KAAK,EAAE;IACnD,OAAOhC,QAAA,CAAAC,OAAA,CAAQgC,GAAG,CAAC,CAACf,iBAAiB,CAACa,IAAI,CAAC,EAAEb,iBAAiB,CAACc,KAAK,CAAC,CAAC,CAAC,CAACE,IAAI,CAAC,UAACC,OAAO,EAAK;MACxF,IAAMC,SAAS,GAAGD,OAAO,CAAC,CAAC,CAAC;MAC5B,IAAME,UAAU,GAAGF,OAAO,CAAC,CAAC,CAAC;MAE7B,IAAI,CAACP,QAAQ,CAACZ,YAAY,CAACoB,SAAS,CAAC,EAAE;QACrC,MAAM,IAAIrC,KAAK,CAAC,gCAAgC,CAAC;MACnD;MAEA,IAAI,CAAC6B,QAAQ,CAACZ,YAAY,CAACqB,UAAU,CAAC,EAAE;QACtC,MAAM,IAAItC,KAAK,CAAC,iCAAiC,CAAC;MACpD;MAEA,IAAIqC,SAAS,CAACE,UAAU,KAAKD,UAAU,CAACC,UAAU,EAAE;QAClD,OAAO,KAAK;MACd;MAEA,IAAMC,CAAC,GAAG,IAAI3B,UAAU,CAACwB,SAAS,CAAC;MACnC,IAAMI,CAAC,GAAG,IAAI5B,UAAU,CAACyB,UAAU,CAAC;MAEpC,KAAK,IAAII,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,CAAC,CAACG,MAAM,EAAED,CAAC,IAAI,CAAC,EAAE;QACpC,IAAIF,CAAC,CAACE,CAAC,CAAC,KAAKD,CAAC,CAACC,CAAC,CAAC,EAAE;UACjB,OAAO,KAAK;QACd;MACF;MAEA,OAAO,IAAI;IACb,CAAC,CAAC;EACJ;AACF,CAAC;AAEDE,MAAM,CAACC,OAAO,GAAGhB,QAAQ"}