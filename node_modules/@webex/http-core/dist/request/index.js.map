{"version":3,"names":["_events","require","_request2","_interopRequireDefault","request","options","url","uri","headers","download","EventEmitter","upload","intercept","interceptors","then","_len","arguments","length","args","Array","_key","_request","apply","concat","_len2","_key2","slice","reverse","key","res","successKey","errorKey","reduce","promise","interceptor","result","logOptions","_promise","default","resolve","reason","reject"],"sources":["index.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {EventEmitter} from 'events';\n\nimport _request from './request';\n\n/**\n * @param {Object} options\n * @returns {Promise}\n */\nexport default function request(options) {\n  if (options.url) {\n    options.uri = options.url;\n    options.url = null;\n  }\n\n  options.headers = options.headers || {};\n\n  options.download = new EventEmitter();\n  options.upload = new EventEmitter();\n\n  return intercept(options.interceptors, 'Request')\n    .then((...args) => _request(options, ...args))\n    .then((...args) => intercept(options.interceptors.slice().reverse(), 'Response', ...args));\n\n  /**\n   * @param {Array} interceptors\n   * @param {string} key\n   * @param {Object} res\n   * @private\n   * @returns {Promise}\n   */\n  function intercept(interceptors, key, res) {\n    const successKey = `on${key}`;\n    const errorKey = `on${key}Error`;\n\n    return interceptors.reduce(\n      (promise, interceptor) =>\n        promise.then(\n          (result) => {\n            interceptor.logOptions(options);\n            if (interceptor[successKey]) {\n              return interceptor[successKey](options, result);\n            }\n\n            return Promise.resolve(result);\n          },\n          (reason) => {\n            interceptor.logOptions(options);\n            if (interceptor[errorKey]) {\n              return interceptor[errorKey](options, reason);\n            }\n\n            return Promise.reject(reason);\n          }\n        ),\n      Promise.resolve(res)\n    );\n  }\n}\n"],"mappings":";;;;;;;;;AAIA,IAAAA,OAAA,GAAAC,OAAA;AAEA,IAAAC,SAAA,GAAAC,sBAAA,CAAAF,OAAA;AANA;AACA;AACA;;AAMA;AACA;AACA;AACA;AACe,SAASG,OAAOA,CAACC,OAAO,EAAE;EACvC,IAAIA,OAAO,CAACC,GAAG,EAAE;IACfD,OAAO,CAACE,GAAG,GAAGF,OAAO,CAACC,GAAG;IACzBD,OAAO,CAACC,GAAG,GAAG,IAAI;EACpB;EAEAD,OAAO,CAACG,OAAO,GAAGH,OAAO,CAACG,OAAO,IAAI,CAAC,CAAC;EAEvCH,OAAO,CAACI,QAAQ,GAAG,IAAIC,oBAAY,EAAE;EACrCL,OAAO,CAACM,MAAM,GAAG,IAAID,oBAAY,EAAE;EAEnC,OAAOE,SAAS,CAACP,OAAO,CAACQ,YAAY,EAAE,SAAS,CAAC,CAC9CC,IAAI,CAAC;IAAA,SAAAC,IAAA,GAAAC,SAAA,CAAAC,MAAA,EAAIC,IAAI,OAAAC,KAAA,CAAAJ,IAAA,GAAAK,IAAA,MAAAA,IAAA,GAAAL,IAAA,EAAAK,IAAA;MAAJF,IAAI,CAAAE,IAAA,IAAAJ,SAAA,CAAAI,IAAA;IAAA;IAAA,OAAKC,iBAAQ,CAAAC,KAAA,UAACjB,OAAO,EAAAkB,MAAA,CAAKL,IAAI,EAAC;EAAA,EAAC,CAC7CJ,IAAI,CAAC;IAAA,SAAAU,KAAA,GAAAR,SAAA,CAAAC,MAAA,EAAIC,IAAI,OAAAC,KAAA,CAAAK,KAAA,GAAAC,KAAA,MAAAA,KAAA,GAAAD,KAAA,EAAAC,KAAA;MAAJP,IAAI,CAAAO,KAAA,IAAAT,SAAA,CAAAS,KAAA;IAAA;IAAA,OAAKb,SAAS,CAAAU,KAAA,UAACjB,OAAO,CAACQ,YAAY,CAACa,KAAK,EAAE,CAACC,OAAO,EAAE,EAAE,UAAU,EAAAJ,MAAA,CAAKL,IAAI,EAAC;EAAA,EAAC;;EAE5F;AACF;AACA;AACA;AACA;AACA;AACA;EACE,SAASN,SAASA,CAACC,YAAY,EAAEe,GAAG,EAAEC,GAAG,EAAE;IACzC,IAAMC,UAAU,QAAAP,MAAA,CAAQK,GAAG,CAAE;IAC7B,IAAMG,QAAQ,QAAAR,MAAA,CAAQK,GAAG,UAAO;IAEhC,OAAOf,YAAY,CAACmB,MAAM,CACxB,UAACC,OAAO,EAAEC,WAAW;MAAA,OACnBD,OAAO,CAACnB,IAAI,CACV,UAACqB,MAAM,EAAK;QACVD,WAAW,CAACE,UAAU,CAAC/B,OAAO,CAAC;QAC/B,IAAI6B,WAAW,CAACJ,UAAU,CAAC,EAAE;UAC3B,OAAOI,WAAW,CAACJ,UAAU,CAAC,CAACzB,OAAO,EAAE8B,MAAM,CAAC;QACjD;QAEA,OAAOE,QAAA,CAAAC,OAAA,CAAQC,OAAO,CAACJ,MAAM,CAAC;MAChC,CAAC,EACD,UAACK,MAAM,EAAK;QACVN,WAAW,CAACE,UAAU,CAAC/B,OAAO,CAAC;QAC/B,IAAI6B,WAAW,CAACH,QAAQ,CAAC,EAAE;UACzB,OAAOG,WAAW,CAACH,QAAQ,CAAC,CAAC1B,OAAO,EAAEmC,MAAM,CAAC;QAC/C;QAEA,OAAOH,QAAA,CAAAC,OAAA,CAAQG,MAAM,CAACD,MAAM,CAAC;MAC/B,CAAC,CACF;IAAA,GACHH,QAAA,CAAAC,OAAA,CAAQC,OAAO,CAACV,GAAG,CAAC,CACrB;EACH;AACF"}